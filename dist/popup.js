(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var n=t.g.document;if(!e&&n&&(n.currentScript&&"SCRIPT"===n.currentScript.tagName.toUpperCase()&&(e=n.currentScript.src),!e)){var i=n.getElementsByTagName("script");if(i.length)for(var r=i.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=i[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})();let e=null;const n=1315;function i(){e=null,a("connecting","Disconnected"),r();const t=document.getElementById("ip-details");t&&(t.innerHTML='\n      <div class="placeholder">\n        <span class="placeholder-icon">🎯</span>\n        <p>Connect wallet and search for an IP Asset to see its relationship graph</p>\n      </div>\n    '),function(){const t=o("🔌 Disconnected from Story Protocol","info");document.body.appendChild(t),setTimeout(()=>{t.remove()},2e3)}()}function r(){const t=document.getElementById("wallet-status"),n=document.getElementById("connection-status"),i=document.getElementById("wallet-address"),r=document.getElementById("wallet-balance"),a=document.getElementById("wallet-network"),o=document.getElementById("connect-wallet"),s=document.getElementById("disconnect-wallet"),c=document.getElementById("wallet-address-item"),l=document.getElementById("wallet-balance-item"),u=document.getElementById("wallet-network-item");e?.connected?(t&&(t.className="wallet-status connected"),n&&(n.textContent="Connected to Story Protocol"),i&&(i.textContent=`${e.address.slice(0,6)}...${e.address.slice(-4)}`),r&&(r.textContent=`${e.balance} IP`),a&&(a.textContent="Story Aeneid Testnet"),c&&(c.style.display="flex"),l&&(l.style.display="flex"),u&&(u.style.display="flex"),o&&(o.style.display="none"),s&&(s.style.display="block")):(t&&(t.className="wallet-status"),n&&(n.textContent="Connect to Story Protocol"),c&&(c.style.display="none"),l&&(l.style.display="none"),u&&(u.style.display="none"),o&&(o.style.display="block"),s&&(s.style.display="none"))}function a(t,e){const n=document.getElementById("wallet-status"),i=document.getElementById("connection-status");n&&(n.className=`wallet-status ${t}`),i&&(i.textContent=e)}function o(t,e){const n=document.createElement("div");return n.className=`notification notification-${e}`,n.textContent=t,n.style.cssText="\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    padding: 16px 24px;\n    border-radius: 12px;\n    color: white;\n    font-weight: 600;\n    font-size: 14px;\n    z-index: 10001;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);\n    animation: slideInRight 0.3s ease;\n    max-width: 300px;\n  ",n.style.background={success:"linear-gradient(135deg, #10b981, #059669)",error:"linear-gradient(135deg, #ef4444, #dc2626)",info:"linear-gradient(135deg, #3b82f6, #1d4ed8)"}[e],n}const s=document.createElement("style");function c(){}function l(t){return null==t?c:function(){return this.querySelector(t)}}function u(){return[]}function d(t){return null==t?u:function(){return this.querySelectorAll(t)}}function h(t){return function(){return this.matches(t)}}function f(t){return function(e){return e.matches(t)}}s.textContent="\n  @keyframes slideInRight {\n    from {\n      transform: translateX(100%);\n      opacity: 0;\n    }\n    to {\n      transform: translateX(0);\n      opacity: 1;\n    }\n  }\n  \n  .user-assets {\n    margin-top: 15px;\n  }\n  \n  .user-assets h3 {\n    margin-bottom: 12px;\n    color: #333;\n    font-size: 14px;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n  }\n  \n  .assets-list {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n  }\n  \n  .asset-item {\n    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);\n    padding: 12px;\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    border: 1px solid #dee2e6;\n  }\n  \n  .asset-item:hover {\n    background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);\n    transform: translateY(-1px);\n    box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n  }\n  \n  .asset-name {\n    font-weight: 600;\n    font-size: 13px;\n    color: #333;\n    margin-bottom: 6px;\n  }\n  \n  .asset-id {\n    font-family: monospace;\n    font-size: 10px;\n    color: #666;\n    margin-bottom: 8px;\n    background: rgba(255,255,255,0.7);\n    padding: 2px 6px;\n    border-radius: 4px;\n    display: inline-block;\n  }\n  \n  .asset-stats {\n    display: flex;\n    justify-content: space-between;\n    font-size: 11px;\n    color: #555;\n    font-weight: 500;\n  }\n  \n  .asset-stats span {\n    display: flex;\n    align-items: center;\n    gap: 2px;\n  }\n",document.head.appendChild(s);var p=Array.prototype.find;function v(){return this.firstElementChild}var g=Array.prototype.filter;function m(){return Array.from(this.children)}function y(t){return new Array(t.length)}function w(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function x(t,e,n,i,r,a){for(var o,s=0,c=e.length,l=a.length;s<l;++s)(o=e[s])?(o.__data__=a[s],i[s]=o):n[s]=new w(t,a[s]);for(;s<c;++s)(o=e[s])&&(r[s]=o)}function b(t,e,n,i,r,a,o){var s,c,l,u=new Map,d=e.length,h=a.length,f=new Array(d);for(s=0;s<d;++s)(c=e[s])&&(f[s]=l=o.call(c,c.__data__,s,e)+"",u.has(l)?r[s]=c:u.set(l,c));for(s=0;s<h;++s)l=o.call(t,a[s],s,a)+"",(c=u.get(l))?(i[s]=c,c.__data__=a[s],u.delete(l)):n[s]=new w(t,a[s]);for(s=0;s<d;++s)(c=e[s])&&u.get(f[s])===c&&(r[s]=c)}function _(t){return t.__data__}function k(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function M(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}w.prototype={constructor:w,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var S="http://www.w3.org/1999/xhtml";const A={svg:"http://www.w3.org/2000/svg",xhtml:S,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function I(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),A.hasOwnProperty(e)?{space:A[e],local:t}:t}function E(t){return function(){this.removeAttribute(t)}}function $(t){return function(){this.removeAttributeNS(t.space,t.local)}}function P(t,e){return function(){this.setAttribute(t,e)}}function N(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function T(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function R(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function z(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function C(t){return function(){this.style.removeProperty(t)}}function D(t,e,n){return function(){this.style.setProperty(t,e,n)}}function L(t,e,n){return function(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function B(t,e){return t.style.getPropertyValue(e)||z(t).getComputedStyle(t,null).getPropertyValue(e)}function q(t){return function(){delete this[t]}}function G(t,e){return function(){this[t]=e}}function O(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function j(t){return t.trim().split(/^|\s+/)}function F(t){return t.classList||new H(t)}function H(t){this._node=t,this._names=j(t.getAttribute("class")||"")}function X(t,e){for(var n=F(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function U(t,e){for(var n=F(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function Y(t){return function(){X(this,t)}}function V(t){return function(){U(this,t)}}function Z(t,e){return function(){(e.apply(this,arguments)?X:U)(this,t)}}function W(){this.textContent=""}function J(t){return function(){this.textContent=t}}function K(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function Q(){this.innerHTML=""}function tt(t){return function(){this.innerHTML=t}}function et(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function nt(){this.nextSibling&&this.parentNode.appendChild(this)}function it(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function rt(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===S&&e.documentElement.namespaceURI===S?e.createElement(t):e.createElementNS(n,t)}}function at(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function ot(t){var e=I(t);return(e.local?at:rt)(e)}function st(){return null}function ct(){var t=this.parentNode;t&&t.removeChild(this)}function lt(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ut(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function dt(t){return function(){var e=this.__on;if(e){for(var n,i=0,r=-1,a=e.length;i<a;++i)n=e[i],t.type&&n.type!==t.type||n.name!==t.name?e[++r]=n:this.removeEventListener(n.type,n.listener,n.options);++r?e.length=r:delete this.__on}}}function ht(t,e,n){return function(){var i,r=this.__on,a=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(r)for(var o=0,s=r.length;o<s;++o)if((i=r[o]).type===t.type&&i.name===t.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=a,i.options=n),void(i.value=e);this.addEventListener(t.type,a,n),i={type:t.type,name:t.name,value:e,listener:a,options:n},r?r.push(i):this.__on=[i]}}function ft(t,e,n){var i=z(t),r=i.CustomEvent;"function"==typeof r?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function pt(t,e){return function(){return ft(this,t,e)}}function vt(t,e){return function(){return ft(this,t,e.apply(this,arguments))}}H.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var gt=[null];function mt(t,e){this._groups=t,this._parents=e}function yt(){return new mt([[document.documentElement]],gt)}mt.prototype=yt.prototype={constructor:mt,select:function(t){"function"!=typeof t&&(t=l(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var a,o,s=e[r],c=s.length,u=i[r]=new Array(c),d=0;d<c;++d)(a=s[d])&&(o=t.call(a,a.__data__,d,s))&&("__data__"in a&&(o.__data__=a.__data__),u[d]=o);return new mt(i,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return null==(e=t.apply(this,arguments))?[]:Array.isArray(e)?e:Array.from(e);var e}}(t):d(t);for(var e=this._groups,n=e.length,i=[],r=[],a=0;a<n;++a)for(var o,s=e[a],c=s.length,l=0;l<c;++l)(o=s[l])&&(i.push(t.call(o,o.__data__,l,s)),r.push(o));return new mt(i,r)},selectChild:function(t){return this.select(null==t?v:function(t){return function(){return p.call(this.children,t)}}("function"==typeof t?t:f(t)))},selectChildren:function(t){return this.selectAll(null==t?m:function(t){return function(){return g.call(this.children,t)}}("function"==typeof t?t:f(t)))},filter:function(t){"function"!=typeof t&&(t=h(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var a,o=e[r],s=o.length,c=i[r]=[],l=0;l<s;++l)(a=o[l])&&t.call(a,a.__data__,l,o)&&c.push(a);return new mt(i,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,_);var n,i=e?b:x,r=this._parents,a=this._groups;"function"!=typeof t&&(n=t,t=function(){return n});for(var o=a.length,s=new Array(o),c=new Array(o),l=new Array(o),u=0;u<o;++u){var d=r[u],h=a[u],f=h.length,p=k(t.call(d,d&&d.__data__,u,r)),v=p.length,g=c[u]=new Array(v),m=s[u]=new Array(v);i(d,h,g,m,l[u]=new Array(f),p,e);for(var y,w,M=0,S=0;M<v;++M)if(y=g[M]){for(M>=S&&(S=M+1);!(w=m[S])&&++S<v;);y._next=w||null}}return(s=new mt(s,r))._enter=c,s._exit=l,s},enter:function(){return new mt(this._enter||this._groups.map(y),this._parents)},exit:function(){return new mt(this._exit||this._groups.map(y),this._parents)},join:function(t,e,n){var i=this.enter(),r=this,a=this.exit();return"function"==typeof t?(i=t(i))&&(i=i.selection()):i=i.append(t+""),null!=e&&(r=e(r))&&(r=r.selection()),null==n?a.remove():n(a),i&&r?i.merge(r).order():r},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,a=i.length,o=Math.min(r,a),s=new Array(r),c=0;c<o;++c)for(var l,u=n[c],d=i[c],h=u.length,f=s[c]=new Array(h),p=0;p<h;++p)(l=u[p]||d[p])&&(f[p]=l);for(;c<r;++c)s[c]=n[c];return new mt(s,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i,r=t[e],a=r.length-1,o=r[a];--a>=0;)(i=r[a])&&(o&&4^i.compareDocumentPosition(o)&&o.parentNode.insertBefore(i,o),o=i);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=M);for(var n=this._groups,i=n.length,r=new Array(i),a=0;a<i;++a){for(var o,s=n[a],c=s.length,l=r[a]=new Array(c),u=0;u<c;++u)(o=s[u])&&(l[u]=o);l.sort(e)}return new mt(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,a=i.length;r<a;++r){var o=i[r];if(o)return o}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r,a=e[n],o=0,s=a.length;o<s;++o)(r=a[o])&&t.call(r,r.__data__,o,a);return this},attr:function(t,e){var n=I(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==e?n.local?$:E:"function"==typeof e?n.local?R:T:n.local?N:P)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?C:"function"==typeof e?L:D)(t,e,null==n?"":n)):B(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?q:"function"==typeof e?O:G)(t,e)):this.node()[t]},classed:function(t,e){var n=j(t+"");if(arguments.length<2){for(var i=F(this.node()),r=-1,a=n.length;++r<a;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof e?Z:e?Y:V)(n,e))},text:function(t){return arguments.length?this.each(null==t?W:("function"==typeof t?K:J)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?Q:("function"==typeof t?et:tt)(t)):this.node().innerHTML},raise:function(){return this.each(nt)},lower:function(){return this.each(it)},append:function(t){var e="function"==typeof t?t:ot(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})},insert:function(t,e){var n="function"==typeof t?t:ot(t),i=null==e?st:"function"==typeof e?e:l(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})},remove:function(){return this.each(ct)},clone:function(t){return this.select(t?ut:lt)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var i,r,a=function(t){return t.trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}})}(t+""),o=a.length;if(!(arguments.length<2)){for(s=e?ht:dt,i=0;i<o;++i)this.each(s(a[i],e,n));return this}var s=this.node().__on;if(s)for(var c,l=0,u=s.length;l<u;++l)for(i=0,c=s[l];i<o;++i)if((r=a[i]).type===c.type&&r.name===c.name)return c.value},dispatch:function(t,e){return this.each(("function"==typeof e?vt:pt)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i,r=t[e],a=0,o=r.length;a<o;++a)(i=r[a])&&(yield i)}};const wt=yt;var xt={value:()=>{}};function bt(){for(var t,e=0,n=arguments.length,i={};e<n;++e){if(!(t=arguments[e]+"")||t in i||/[\s.]/.test(t))throw new Error("illegal type: "+t);i[t]=[]}return new _t(i)}function _t(t){this._=t}function kt(t,e){for(var n,i=0,r=t.length;i<r;++i)if((n=t[i]).name===e)return n.value}function Mt(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=xt,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=n&&t.push({name:e,value:n}),t}_t.prototype=bt.prototype={constructor:_t,on:function(t,e){var n,i,r=this._,a=(i=r,(t+"").trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!i.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}})),o=-1,s=a.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<s;)if(n=(t=a[o]).type)r[n]=Mt(r[n],t.name,e);else if(null==e)for(n in r)r[n]=Mt(r[n],t.name,null);return this}for(;++o<s;)if((n=(t=a[o]).type)&&(n=kt(r[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new _t(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,i,r=new Array(n),a=0;a<n;++a)r[a]=arguments[a+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=0,n=(i=this._[t]).length;a<n;++a)i[a].value.apply(e,r)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,a=i.length;r<a;++r)i[r].value.apply(e,n)}};const St=bt;var At,It,Et=0,$t=0,Pt=0,Nt=0,Tt=0,Rt=0,zt="object"==typeof performance&&performance.now?performance:Date,Ct="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Dt(){return Tt||(Ct(Lt),Tt=zt.now()+Rt)}function Lt(){Tt=0}function Bt(){this._call=this._time=this._next=null}function qt(t,e,n){var i=new Bt;return i.restart(t,e,n),i}function Gt(){Tt=(Nt=zt.now())+Rt,Et=$t=0;try{!function(){Dt(),++Et;for(var t,e=At;e;)(t=Tt-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Et}()}finally{Et=0,function(){for(var t,e,n=At,i=1/0;n;)n._call?(i>n._time&&(i=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:At=e);It=t,jt(i)}(),Tt=0}}function Ot(){var t=zt.now(),e=t-Nt;e>1e3&&(Rt-=e,Nt=t)}function jt(t){Et||($t&&($t=clearTimeout($t)),t-Tt>24?(t<1/0&&($t=setTimeout(Gt,t-zt.now()-Rt)),Pt&&(Pt=clearInterval(Pt))):(Pt||(Nt=zt.now(),Pt=setInterval(Ot,1e3)),Et=1,Ct(Gt)))}function Ft(t,e,n){var i=new Bt;return e=null==e?0:+e,i.restart(n=>{i.stop(),t(n+e)},e,n),i}Bt.prototype=qt.prototype={constructor:Bt,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?Dt():+n)+(null==e?0:+e),this._next||It===this||(It?It._next=this:At=this,It=this),this._call=t,this._time=n,jt()},stop:function(){this._call&&(this._call=null,this._time=1/0,jt())}};var Ht=St("start","end","cancel","interrupt"),Xt=[];function Ut(t,e,n,i,r,a){var o=t.__transition;if(o){if(n in o)return}else t.__transition={};!function(t,e,n){var i,r=t.__transition;function a(c){var l,u,d,h;if(1!==n.state)return s();for(l in r)if((h=r[l]).name===n.name){if(3===h.state)return Ft(a);4===h.state?(h.state=6,h.timer.stop(),h.on.call("interrupt",t,t.__data__,h.index,h.group),delete r[l]):+l<e&&(h.state=6,h.timer.stop(),h.on.call("cancel",t,t.__data__,h.index,h.group),delete r[l])}if(Ft(function(){3===n.state&&(n.state=4,n.timer.restart(o,n.delay,n.time),o(c))}),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,i=new Array(d=n.tween.length),l=0,u=-1;l<d;++l)(h=n.tween[l].value.call(t,t.__data__,n.index,n.group))&&(i[++u]=h);i.length=u+1}}function o(e){for(var r=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(s),n.state=5,1),a=-1,o=i.length;++a<o;)i[a].call(t,r);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),s())}function s(){for(var i in n.state=6,n.timer.stop(),delete r[e],r)return;delete t.__transition}r[e]=n,n.timer=qt(function(t){n.state=1,n.timer.restart(a,n.delay,n.time),n.delay<=t&&a(t-n.delay)},0,n.time)}(t,n,{name:e,index:i,group:r,on:Ht,tween:Xt,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:0})}function Yt(t,e){var n=Zt(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function Vt(t,e){var n=Zt(t,e);if(n.state>3)throw new Error("too late; already running");return n}function Zt(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Wt(t,e){var n,i,r,a=t.__transition,o=!0;if(a){for(r in e=null==e?null:e+"",a)(n=a[r]).name===e?(i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete a[r]):o=!1;o&&delete t.__transition}}function Jt(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var Kt,Qt=180/Math.PI,te={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function ee(t,e,n,i,r,a){var o,s,c;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(c=t*n+e*i)&&(n-=t*c,i-=e*c),(s=Math.sqrt(n*n+i*i))&&(n/=s,i/=s,c/=s),t*i<e*n&&(t=-t,e=-e,c=-c,o=-o),{translateX:r,translateY:a,rotate:Math.atan2(e,t)*Qt,skewX:Math.atan(c)*Qt,scaleX:o,scaleY:s}}function ne(t,e,n,i){function r(t){return t.length?t.pop()+" ":""}return function(a,o){var s=[],c=[];return a=t(a),o=t(o),function(t,i,r,a,o,s){if(t!==r||i!==a){var c=o.push("translate(",null,e,null,n);s.push({i:c-4,x:Jt(t,r)},{i:c-2,x:Jt(i,a)})}else(r||a)&&o.push("translate("+r+e+a+n)}(a.translateX,a.translateY,o.translateX,o.translateY,s,c),function(t,e,n,a){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),a.push({i:n.push(r(n)+"rotate(",null,i)-2,x:Jt(t,e)})):e&&n.push(r(n)+"rotate("+e+i)}(a.rotate,o.rotate,s,c),function(t,e,n,a){t!==e?a.push({i:n.push(r(n)+"skewX(",null,i)-2,x:Jt(t,e)}):e&&n.push(r(n)+"skewX("+e+i)}(a.skewX,o.skewX,s,c),function(t,e,n,i,a,o){if(t!==n||e!==i){var s=a.push(r(a)+"scale(",null,",",null,")");o.push({i:s-4,x:Jt(t,n)},{i:s-2,x:Jt(e,i)})}else 1===n&&1===i||a.push(r(a)+"scale("+n+","+i+")")}(a.scaleX,a.scaleY,o.scaleX,o.scaleY,s,c),a=o=null,function(t){for(var e,n=-1,i=c.length;++n<i;)s[(e=c[n]).i]=e.x(t);return s.join("")}}}var ie=ne(function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?te:ee(e.a,e.b,e.c,e.d,e.e,e.f)},"px, ","px)","deg)"),re=ne(function(t){return null==t?te:(Kt||(Kt=document.createElementNS("http://www.w3.org/2000/svg","g")),Kt.setAttribute("transform",t),(t=Kt.transform.baseVal.consolidate())?ee((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):te)},", ",")",")");function ae(t,e){var n,i;return function(){var r=Vt(this,t),a=r.tween;if(a!==n)for(var o=0,s=(i=n=a).length;o<s;++o)if(i[o].name===e){(i=i.slice()).splice(o,1);break}r.tween=i}}function oe(t,e,n){var i,r;if("function"!=typeof n)throw new Error;return function(){var a=Vt(this,t),o=a.tween;if(o!==i){r=(i=o).slice();for(var s={name:e,value:n},c=0,l=r.length;c<l;++c)if(r[c].name===e){r[c]=s;break}c===l&&r.push(s)}a.tween=r}}function se(t,e,n){var i=t._id;return t.each(function(){var t=Vt(this,i);(t.value||(t.value={}))[e]=n.apply(this,arguments)}),function(t){return Zt(t,i).value[e]}}function ce(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function le(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function ue(){}var de=.7,he=1/de,fe="\\s*([+-]?\\d+)\\s*",pe="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ve="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ge=/^#([0-9a-f]{3,8})$/,me=new RegExp(`^rgb\\(${fe},${fe},${fe}\\)$`),ye=new RegExp(`^rgb\\(${ve},${ve},${ve}\\)$`),we=new RegExp(`^rgba\\(${fe},${fe},${fe},${pe}\\)$`),xe=new RegExp(`^rgba\\(${ve},${ve},${ve},${pe}\\)$`),be=new RegExp(`^hsl\\(${pe},${ve},${ve}\\)$`),_e=new RegExp(`^hsla\\(${pe},${ve},${ve},${pe}\\)$`),ke={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Me(){return this.rgb().formatHex()}function Se(){return this.rgb().formatRgb()}function Ae(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=ge.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Ie(e):3===n?new Pe(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?Ee(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?Ee(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=me.exec(t))?new Pe(e[1],e[2],e[3],1):(e=ye.exec(t))?new Pe(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=we.exec(t))?Ee(e[1],e[2],e[3],e[4]):(e=xe.exec(t))?Ee(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=be.exec(t))?De(e[1],e[2]/100,e[3]/100,1):(e=_e.exec(t))?De(e[1],e[2]/100,e[3]/100,e[4]):ke.hasOwnProperty(t)?Ie(ke[t]):"transparent"===t?new Pe(NaN,NaN,NaN,0):null}function Ie(t){return new Pe(t>>16&255,t>>8&255,255&t,1)}function Ee(t,e,n,i){return i<=0&&(t=e=n=NaN),new Pe(t,e,n,i)}function $e(t,e,n,i){return 1===arguments.length?((r=t)instanceof ue||(r=Ae(r)),r?new Pe((r=r.rgb()).r,r.g,r.b,r.opacity):new Pe):new Pe(t,e,n,null==i?1:i);var r}function Pe(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}function Ne(){return`#${Ce(this.r)}${Ce(this.g)}${Ce(this.b)}`}function Te(){const t=Re(this.opacity);return`${1===t?"rgb(":"rgba("}${ze(this.r)}, ${ze(this.g)}, ${ze(this.b)}${1===t?")":`, ${t})`}`}function Re(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function ze(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Ce(t){return((t=ze(t))<16?"0":"")+t.toString(16)}function De(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Be(t,e,n,i)}function Le(t){if(t instanceof Be)return new Be(t.h,t.s,t.l,t.opacity);if(t instanceof ue||(t=Ae(t)),!t)return new Be;if(t instanceof Be)return t;var e=(t=t.rgb()).r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),a=Math.max(e,n,i),o=NaN,s=a-r,c=(a+r)/2;return s?(o=e===a?(n-i)/s+6*(n<i):n===a?(i-e)/s+2:(e-n)/s+4,s/=c<.5?a+r:2-a-r,o*=60):s=c>0&&c<1?0:o,new Be(o,s,c,t.opacity)}function Be(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function qe(t){return(t=(t||0)%360)<0?t+360:t}function Ge(t){return Math.max(0,Math.min(1,t||0))}function Oe(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function je(t,e,n,i,r){var a=t*t,o=a*t;return((1-3*t+3*a-o)*e+(4-6*a+3*o)*n+(1+3*t+3*a-3*o)*i+o*r)/6}ce(ue,Ae,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Me,formatHex:Me,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Le(this).formatHsl()},formatRgb:Se,toString:Se}),ce(Pe,$e,le(ue,{brighter(t){return t=null==t?he:Math.pow(he,t),new Pe(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?de:Math.pow(de,t),new Pe(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Pe(ze(this.r),ze(this.g),ze(this.b),Re(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ne,formatHex:Ne,formatHex8:function(){return`#${Ce(this.r)}${Ce(this.g)}${Ce(this.b)}${Ce(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Te,toString:Te})),ce(Be,function(t,e,n,i){return 1===arguments.length?Le(t):new Be(t,e,n,null==i?1:i)},le(ue,{brighter(t){return t=null==t?he:Math.pow(he,t),new Be(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?de:Math.pow(de,t),new Be(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new Pe(Oe(t>=240?t-240:t+120,r,i),Oe(t,r,i),Oe(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new Be(qe(this.h),Ge(this.s),Ge(this.l),Re(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Re(this.opacity);return`${1===t?"hsl(":"hsla("}${qe(this.h)}, ${100*Ge(this.s)}%, ${100*Ge(this.l)}%${1===t?")":`, ${t})`}`}}));const Fe=t=>()=>t;function He(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):Fe(isNaN(t)?e:t)}const Xe=function t(e){var n=function(t){return 1===(t=+t)?He:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}(e,n,t):Fe(isNaN(e)?n:e)}}(e);function i(t,e){var i=n((t=$e(t)).r,(e=$e(e)).r),r=n(t.g,e.g),a=n(t.b,e.b),o=He(t.opacity,e.opacity);return function(e){return t.r=i(e),t.g=r(e),t.b=a(e),t.opacity=o(e),t+""}}return i.gamma=t,i}(1);function Ue(t){return function(e){var n,i,r=e.length,a=new Array(r),o=new Array(r),s=new Array(r);for(n=0;n<r;++n)i=$e(e[n]),a[n]=i.r||0,o[n]=i.g||0,s[n]=i.b||0;return a=t(a),o=t(o),s=t(s),i.opacity=1,function(t){return i.r=a(t),i.g=o(t),i.b=s(t),i+""}}}Ue(function(t){var e=t.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),r=t[i],a=t[i+1],o=i>0?t[i-1]:2*r-a,s=i<e-1?t[i+2]:2*a-r;return je((n-i/e)*e,o,r,a,s)}}),Ue(function(t){var e=t.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*e),r=t[(i+e-1)%e],a=t[i%e],o=t[(i+1)%e],s=t[(i+2)%e];return je((n-i/e)*e,r,a,o,s)}});var Ye=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ve=new RegExp(Ye.source,"g");function Ze(t,e){var n,i,r,a=Ye.lastIndex=Ve.lastIndex=0,o=-1,s=[],c=[];for(t+="",e+="";(n=Ye.exec(t))&&(i=Ve.exec(e));)(r=i.index)>a&&(r=e.slice(a,r),s[o]?s[o]+=r:s[++o]=r),(n=n[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,c.push({i:o,x:Jt(n,i)})),a=Ve.lastIndex;return a<e.length&&(r=e.slice(a),s[o]?s[o]+=r:s[++o]=r),s.length<2?c[0]?function(t){return function(e){return t(e)+""}}(c[0].x):function(t){return function(){return t}}(e):(e=c.length,function(t){for(var n,i=0;i<e;++i)s[(n=c[i]).i]=n.x(t);return s.join("")})}function We(t,e){var n;return("number"==typeof e?Jt:e instanceof Ae?Xe:(n=Ae(e))?(e=n,Xe):Ze)(t,e)}function Je(t){return function(){this.removeAttribute(t)}}function Ke(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Qe(t,e,n){var i,r,a=n+"";return function(){var o=this.getAttribute(t);return o===a?null:o===i?r:r=e(i=o,n)}}function tn(t,e,n){var i,r,a=n+"";return function(){var o=this.getAttributeNS(t.space,t.local);return o===a?null:o===i?r:r=e(i=o,n)}}function en(t,e,n){var i,r,a;return function(){var o,s,c=n(this);if(null!=c)return(o=this.getAttribute(t))===(s=c+"")?null:o===i&&s===r?a:(r=s,a=e(i=o,c));this.removeAttribute(t)}}function nn(t,e,n){var i,r,a;return function(){var o,s,c=n(this);if(null!=c)return(o=this.getAttributeNS(t.space,t.local))===(s=c+"")?null:o===i&&s===r?a:(r=s,a=e(i=o,c));this.removeAttributeNS(t.space,t.local)}}function rn(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&function(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}(t,r)),n}return r._value=e,r}function an(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&function(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}(t,r)),n}return r._value=e,r}function on(t,e){return function(){Yt(this,t).delay=+e.apply(this,arguments)}}function sn(t,e){return e=+e,function(){Yt(this,t).delay=e}}function cn(t,e){return function(){Vt(this,t).duration=+e.apply(this,arguments)}}function ln(t,e){return e=+e,function(){Vt(this,t).duration=e}}var un=wt.prototype.constructor;function dn(t){return function(){this.style.removeProperty(t)}}var hn=0;function fn(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function pn(){return++hn}var vn=wt.prototype;fn.prototype=function(t){return wt().transition(t)}.prototype={constructor:fn,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=l(t));for(var i=this._groups,r=i.length,a=new Array(r),o=0;o<r;++o)for(var s,c,u=i[o],d=u.length,h=a[o]=new Array(d),f=0;f<d;++f)(s=u[f])&&(c=t.call(s,s.__data__,f,u))&&("__data__"in s&&(c.__data__=s.__data__),h[f]=c,Ut(h[f],e,n,f,h,Zt(s,n)));return new fn(a,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=d(t));for(var i=this._groups,r=i.length,a=[],o=[],s=0;s<r;++s)for(var c,l=i[s],u=l.length,h=0;h<u;++h)if(c=l[h]){for(var f,p=t.call(c,c.__data__,h,l),v=Zt(c,n),g=0,m=p.length;g<m;++g)(f=p[g])&&Ut(f,e,n,g,p,v);a.push(p),o.push(c)}return new fn(a,o,e,n)},selectChild:vn.selectChild,selectChildren:vn.selectChildren,filter:function(t){"function"!=typeof t&&(t=h(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var a,o=e[r],s=o.length,c=i[r]=[],l=0;l<s;++l)(a=o[l])&&t.call(a,a.__data__,l,o)&&c.push(a);return new fn(i,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,a=Math.min(i,r),o=new Array(i),s=0;s<a;++s)for(var c,l=e[s],u=n[s],d=l.length,h=o[s]=new Array(d),f=0;f<d;++f)(c=l[f]||u[f])&&(h[f]=c);for(;s<i;++s)o[s]=e[s];return new fn(o,this._parents,this._name,this._id)},selection:function(){return new un(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=pn(),i=this._groups,r=i.length,a=0;a<r;++a)for(var o,s=i[a],c=s.length,l=0;l<c;++l)if(o=s[l]){var u=Zt(o,e);Ut(o,t,n,l,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new fn(i,this._parents,t,n)},call:vn.call,nodes:vn.nodes,node:vn.node,size:vn.size,empty:vn.empty,each:vn.each,on:function(t,e){var n=this._id;return arguments.length<2?Zt(this.node(),n).on.on(t):this.each(function(t,e,n){var i,r,a=function(t){return(t+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t})}(e)?Yt:Vt;return function(){var o=a(this,t),s=o.on;s!==i&&(r=(i=s).copy()).on(e,n),o.on=r}}(n,t,e))},attr:function(t,e){var n=I(t),i="transform"===n?re:We;return this.attrTween(t,"function"==typeof e?(n.local?nn:en)(n,i,se(this,"attr."+t,e)):null==e?(n.local?Ke:Je)(n):(n.local?tn:Qe)(n,i,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var i=I(t);return this.tween(n,(i.local?rn:an)(i,e))},style:function(t,e,n){var i="transform"==(t+="")?ie:We;return null==e?this.styleTween(t,function(t,e){var n,i,r;return function(){var a=B(this,t),o=(this.style.removeProperty(t),B(this,t));return a===o?null:a===n&&o===i?r:r=e(n=a,i=o)}}(t,i)).on("end.style."+t,dn(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var i,r,a;return function(){var o=B(this,t),s=n(this),c=s+"";return null==s&&(this.style.removeProperty(t),c=s=B(this,t)),o===c?null:o===i&&c===r?a:(r=c,a=e(i=o,s))}}(t,i,se(this,"style."+t,e))).each(function(t,e){var n,i,r,a,o="style."+e,s="end."+o;return function(){var c=Vt(this,t),l=c.on,u=null==c.value[o]?a||(a=dn(e)):void 0;l===n&&r===u||(i=(n=l).copy()).on(s,r=u),c.on=i}}(this._id,t)):this.styleTween(t,function(t,e,n){var i,r,a=n+"";return function(){var o=B(this,t);return o===a?null:o===i?r:r=e(i=o,n)}}(t,i,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw new Error;return this.tween(i,function(t,e,n){var i,r;function a(){var a=e.apply(this,arguments);return a!==r&&(i=(r=a)&&function(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}(t,a,n)),i}return a._value=e,a}(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(se(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,function(t){var e,n;function i(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&function(t){return function(e){this.textContent=t.call(this,e)}}(i)),e}return i._value=t,i}(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i,r=Zt(this.node(),n).tween,a=0,o=r.length;a<o;++a)if((i=r[a]).name===t)return i.value;return null}return this.each((null==e?ae:oe)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?on:sn)(e,t)):Zt(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?cn:ln)(e,t)):Zt(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){Vt(this,t).ease=e}}(e,t)):Zt(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;Vt(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,i=n._id,r=n.size();return new Promise(function(a,o){var s={value:o},c={value:function(){0===--r&&a()}};n.each(function(){var n=Vt(this,i),r=n.on;r!==t&&((e=(t=r).copy())._.cancel.push(s),e._.interrupt.push(s),e._.end.push(c)),n.on=e}),0===r&&a()})},[Symbol.iterator]:vn[Symbol.iterator]};var gn={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function mn(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}wt.prototype.interrupt=function(t){return this.each(function(){Wt(this,t)})},wt.prototype.transition=function(t){var e,n;t instanceof fn?(e=t._id,t=t._name):(e=pn(),(n=gn).time=Dt(),t=null==t?null:t+"");for(var i=this._groups,r=i.length,a=0;a<r;++a)for(var o,s=i[a],c=s.length,l=0;l<c;++l)(o=s[l])&&Ut(o,t,e,l,s,n||mn(o,e));return new fn(i,this._parents,t,e)};const{abs:yn,max:wn,min:xn}=Math;function bn(t){return{type:t}}function _n(t){return"string"==typeof t?new mt([[document.querySelector(t)]],[document.documentElement]):new mt([[t]],gt)}function kn(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,[(i=i.matrixTransform(e.getScreenCTM().inverse())).x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]}["w","e"].map(bn),["n","s"].map(bn),["n","w","e","s","nw","ne","sw","se"].map(bn);const Mn={passive:!1},Sn={capture:!0,passive:!1};function An(t){t.stopImmediatePropagation()}function In(t){t.preventDefault(),t.stopImmediatePropagation()}function En(t){var e=t.document.documentElement,n=_n(t).on("dragstart.drag",In,Sn);"onselectstart"in e?n.on("selectstart.drag",In,Sn):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function $n(t,e){var n=t.document.documentElement,i=_n(t).on("dragstart.drag",null);e&&(i.on("click.drag",In,Sn),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Pn=t=>()=>t;function Nn(t,{sourceEvent:e,subject:n,target:i,identifier:r,active:a,x:o,y:s,dx:c,dy:l,dispatch:u}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:a,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:s,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:l,enumerable:!0,configurable:!0},_:{value:u}})}function Tn(t){return!t.ctrlKey&&!t.button}function Rn(){return this.parentNode}function zn(t,e){return null==e?{x:t.x,y:t.y}:e}function Cn(){return navigator.maxTouchPoints||"ontouchstart"in this}function Dn(t,e){var n,i=1;function r(){var r,a,o=n.length,s=0,c=0;for(r=0;r<o;++r)s+=(a=n[r]).x,c+=a.y;for(s=(s/o-t)*i,c=(c/o-e)*i,r=0;r<o;++r)(a=n[r]).x-=s,a.y-=c}return null==t&&(t=0),null==e&&(e=0),r.initialize=function(t){n=t},r.x=function(e){return arguments.length?(t=+e,r):t},r.y=function(t){return arguments.length?(e=+t,r):e},r.strength=function(t){return arguments.length?(i=+t,r):i},r}function Ln(t,e,n,i){if(isNaN(e)||isNaN(n))return t;var r,a,o,s,c,l,u,d,h,f=t._root,p={data:i},v=t._x0,g=t._y0,m=t._x1,y=t._y1;if(!f)return t._root=p,t;for(;f.length;)if((l=e>=(a=(v+m)/2))?v=a:m=a,(u=n>=(o=(g+y)/2))?g=o:y=o,r=f,!(f=f[d=u<<1|l]))return r[d]=p,t;if(s=+t._x.call(null,f.data),c=+t._y.call(null,f.data),e===s&&n===c)return p.next=f,r?r[d]=p:t._root=p,t;do{r=r?r[d]=new Array(4):t._root=new Array(4),(l=e>=(a=(v+m)/2))?v=a:m=a,(u=n>=(o=(g+y)/2))?g=o:y=o}while((d=u<<1|l)==(h=(c>=o)<<1|s>=a));return r[h]=f,r[d]=p,t}function Bn(t,e,n,i,r){this.node=t,this.x0=e,this.y0=n,this.x1=i,this.y1=r}function qn(t){return t[0]}function Gn(t){return t[1]}function On(t,e,n){var i=new jn(null==e?qn:e,null==n?Gn:n,NaN,NaN,NaN,NaN);return null==t?i:i.addAll(t)}function jn(t,e,n,i,r,a){this._x=t,this._y=e,this._x0=n,this._y0=i,this._x1=r,this._y1=a,this._root=void 0}function Fn(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}Nn.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var Hn=On.prototype=jn.prototype;function Xn(t){return function(){return t}}function Un(t){return 1e-6*(t()-.5)}function Yn(t){return t.x+t.vx}function Vn(t){return t.y+t.vy}function Zn(t){return t.index}function Wn(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}Hn.copy=function(){var t,e,n=new jn(this._x,this._y,this._x0,this._y0,this._x1,this._y1),i=this._root;if(!i)return n;if(!i.length)return n._root=Fn(i),n;for(t=[{source:i,target:n._root=new Array(4)}];i=t.pop();)for(var r=0;r<4;++r)(e=i.source[r])&&(e.length?t.push({source:e,target:i.target[r]=new Array(4)}):i.target[r]=Fn(e));return n},Hn.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return Ln(this.cover(e,n),e,n,t)},Hn.addAll=function(t){var e,n,i,r,a=t.length,o=new Array(a),s=new Array(a),c=1/0,l=1/0,u=-1/0,d=-1/0;for(n=0;n<a;++n)isNaN(i=+this._x.call(null,e=t[n]))||isNaN(r=+this._y.call(null,e))||(o[n]=i,s[n]=r,i<c&&(c=i),i>u&&(u=i),r<l&&(l=r),r>d&&(d=r));if(c>u||l>d)return this;for(this.cover(c,l).cover(u,d),n=0;n<a;++n)Ln(this,o[n],s[n],t[n]);return this},Hn.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,i=this._y0,r=this._x1,a=this._y1;if(isNaN(n))r=(n=Math.floor(t))+1,a=(i=Math.floor(e))+1;else{for(var o,s,c=r-n||1,l=this._root;n>t||t>=r||i>e||e>=a;)switch(s=(e<i)<<1|t<n,(o=new Array(4))[s]=l,l=o,c*=2,s){case 0:r=n+c,a=i+c;break;case 1:n=r-c,a=i+c;break;case 2:r=n+c,i=a-c;break;case 3:n=r-c,i=a-c}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=i,this._x1=r,this._y1=a,this},Hn.data=function(){var t=[];return this.visit(function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)}),t},Hn.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},Hn.find=function(t,e,n){var i,r,a,o,s,c,l,u=this._x0,d=this._y0,h=this._x1,f=this._y1,p=[],v=this._root;for(v&&p.push(new Bn(v,u,d,h,f)),null==n?n=1/0:(u=t-n,d=e-n,h=t+n,f=e+n,n*=n);c=p.pop();)if(!(!(v=c.node)||(r=c.x0)>h||(a=c.y0)>f||(o=c.x1)<u||(s=c.y1)<d))if(v.length){var g=(r+o)/2,m=(a+s)/2;p.push(new Bn(v[3],g,m,o,s),new Bn(v[2],r,m,g,s),new Bn(v[1],g,a,o,m),new Bn(v[0],r,a,g,m)),(l=(e>=m)<<1|t>=g)&&(c=p[p.length-1],p[p.length-1]=p[p.length-1-l],p[p.length-1-l]=c)}else{var y=t-+this._x.call(null,v.data),w=e-+this._y.call(null,v.data),x=y*y+w*w;if(x<n){var b=Math.sqrt(n=x);u=t-b,d=e-b,h=t+b,f=e+b,i=v.data}}return i},Hn.remove=function(t){if(isNaN(a=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t)))return this;var e,n,i,r,a,o,s,c,l,u,d,h,f=this._root,p=this._x0,v=this._y0,g=this._x1,m=this._y1;if(!f)return this;if(f.length)for(;;){if((l=a>=(s=(p+g)/2))?p=s:g=s,(u=o>=(c=(v+m)/2))?v=c:m=c,e=f,!(f=f[d=u<<1|l]))return this;if(!f.length)break;(e[d+1&3]||e[d+2&3]||e[d+3&3])&&(n=e,h=d)}for(;f.data!==t;)if(i=f,!(f=f.next))return this;return(r=f.next)&&delete f.next,i?(r?i.next=r:delete i.next,this):e?(r?e[d]=r:delete e[d],(f=e[0]||e[1]||e[2]||e[3])&&f===(e[3]||e[2]||e[1]||e[0])&&!f.length&&(n?n[h]=f:this._root=f),this):(this._root=r,this)},Hn.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},Hn.root=function(){return this._root},Hn.size=function(){var t=0;return this.visit(function(e){if(!e.length)do{++t}while(e=e.next)}),t},Hn.visit=function(t){var e,n,i,r,a,o,s=[],c=this._root;for(c&&s.push(new Bn(c,this._x0,this._y0,this._x1,this._y1));e=s.pop();)if(!t(c=e.node,i=e.x0,r=e.y0,a=e.x1,o=e.y1)&&c.length){var l=(i+a)/2,u=(r+o)/2;(n=c[3])&&s.push(new Bn(n,l,u,a,o)),(n=c[2])&&s.push(new Bn(n,i,u,l,o)),(n=c[1])&&s.push(new Bn(n,l,r,a,u)),(n=c[0])&&s.push(new Bn(n,i,r,l,u))}return this},Hn.visitAfter=function(t){var e,n=[],i=[];for(this._root&&n.push(new Bn(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var r=e.node;if(r.length){var a,o=e.x0,s=e.y0,c=e.x1,l=e.y1,u=(o+c)/2,d=(s+l)/2;(a=r[0])&&n.push(new Bn(a,o,s,u,d)),(a=r[1])&&n.push(new Bn(a,u,s,c,d)),(a=r[2])&&n.push(new Bn(a,o,d,u,l)),(a=r[3])&&n.push(new Bn(a,u,d,c,l))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},Hn.x=function(t){return arguments.length?(this._x=t,this):this._x},Hn.y=function(t){return arguments.length?(this._y=t,this):this._y};const Jn=4294967296;function Kn(t){return t.x}function Qn(t){return t.y}var ti=Math.PI*(3-Math.sqrt(5));function ei(t){var e,n,i,r=Xn(.1);function a(t){for(var r,a=0,o=e.length;a<o;++a)(r=e[a]).vx+=(i[a]-r.x)*n[a]*t}function o(){if(e){var a,o=e.length;for(n=new Array(o),i=new Array(o),a=0;a<o;++a)n[a]=isNaN(i[a]=+t(e[a],a,e))?0:+r(e[a],a,e)}}return"function"!=typeof t&&(t=Xn(null==t?0:+t)),a.initialize=function(t){e=t,o()},a.strength=function(t){return arguments.length?(r="function"==typeof t?t:Xn(+t),o(),a):r},a.x=function(e){return arguments.length?(t="function"==typeof e?e:Xn(+e),o(),a):t},a}function ni(t){var e,n,i,r=Xn(.1);function a(t){for(var r,a=0,o=e.length;a<o;++a)(r=e[a]).vy+=(i[a]-r.y)*n[a]*t}function o(){if(e){var a,o=e.length;for(n=new Array(o),i=new Array(o),a=0;a<o;++a)n[a]=isNaN(i[a]=+t(e[a],a,e))?0:+r(e[a],a,e)}}return"function"!=typeof t&&(t=Xn(null==t?0:+t)),a.initialize=function(t){e=t,o()},a.strength=function(t){return arguments.length?(r="function"==typeof t?t:Xn(+t),o(),a):r},a.y=function(e){return arguments.length?(t="function"==typeof e?e:Xn(+e),o(),a):t},a}function ii(t){return((t=Math.exp(t))+1/t)/2}const ri=function t(e,n,i){function r(t,r){var a,o,s=t[0],c=t[1],l=t[2],u=r[0],d=r[1],h=r[2],f=u-s,p=d-c,v=f*f+p*p;if(v<1e-12)o=Math.log(h/l)/e,a=function(t){return[s+t*f,c+t*p,l*Math.exp(e*t*o)]};else{var g=Math.sqrt(v),m=(h*h-l*l+i*v)/(2*l*n*g),y=(h*h-l*l-i*v)/(2*h*n*g),w=Math.log(Math.sqrt(m*m+1)-m),x=Math.log(Math.sqrt(y*y+1)-y);o=(x-w)/e,a=function(t){var i,r=t*o,a=ii(w),u=l/(n*g)*(a*(i=e*r+w,((i=Math.exp(2*i))-1)/(i+1))-function(t){return((t=Math.exp(t))-1/t)/2}(w));return[s+u*f,c+u*p,l*a/ii(e*r+w)]}}return a.duration=1e3*o*e/Math.SQRT2,a}return r.rho=function(e){var n=Math.max(.001,+e),i=n*n;return t(n,i,i*i)},r}(Math.SQRT2,2,4),ai=t=>()=>t;function oi(t,{sourceEvent:e,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function si(t,e,n){this.k=t,this.x=e,this.y=n}si.prototype={constructor:si,scale:function(t){return 1===t?this:new si(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new si(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var ci=new si(1,0,0);function li(t){t.stopImmediatePropagation()}function ui(t){t.preventDefault(),t.stopImmediatePropagation()}function di(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function hi(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function fi(){return this.__zoom||ci}function pi(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function vi(){return navigator.maxTouchPoints||"ontouchstart"in this}function gi(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],a=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),o>a?(a+o)/2:Math.min(0,a)||Math.max(0,o))}si.prototype;class mi{constructor(t){this.nodes=[],this.links=[],this.container=t,this.width=t.clientWidth||360,this.height=t.clientHeight||280,this.initializeSVG(),this.initializeSimulation(),this.showPlaceholder()}initializeSVG(){_n(this.container).selectAll("*").remove(),this.svg=_n(this.container).append("svg").attr("width",this.width).attr("height",this.height).style("background","linear-gradient(135deg, #fafbff 0%, #f0f4ff 100%)").style("border-radius","12px");const t=this.svg.append("defs"),e=t.append("linearGradient").attr("id","rootGradient").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","100%");e.append("stop").attr("offset","0%").attr("stop-color","#667eea"),e.append("stop").attr("offset","100%").attr("stop-color","#764ba2");const n=t.append("linearGradient").attr("id","parentGradient").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","100%");n.append("stop").attr("offset","0%").attr("stop-color","#10b981"),n.append("stop").attr("offset","100%").attr("stop-color","#059669");const i=t.append("linearGradient").attr("id","childGradient").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","100%");i.append("stop").attr("offset","0%").attr("stop-color","#f59e0b"),i.append("stop").attr("offset","100%").attr("stop-color","#d97706");const r=t.append("linearGradient").attr("id","derivativeGradient").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","100%");r.append("stop").attr("offset","0%").attr("stop-color","#ef4444"),r.append("stop").attr("offset","100%").attr("stop-color","#dc2626");const a=function(){var t,e,n,i=di,r=hi,a=gi,o=pi,s=vi,c=[0,1/0],l=[[-1/0,-1/0],[1/0,1/0]],u=250,d=ri,h=St("start","zoom","end"),f=0,p=10;function v(t){t.property("__zoom",fi).on("wheel.zoom",_,{passive:!1}).on("mousedown.zoom",k).on("dblclick.zoom",M).filter(s).on("touchstart.zoom",S).on("touchmove.zoom",A).on("touchend.zoom touchcancel.zoom",I).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(t,e){return(e=Math.max(c[0],Math.min(c[1],e)))===t.k?t:new si(e,t.x,t.y)}function m(t,e,n){var i=e[0]-n[0]*t.k,r=e[1]-n[1]*t.k;return i===t.x&&r===t.y?t:new si(t.k,i,r)}function y(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function w(t,e,n,i){t.on("start.zoom",function(){x(this,arguments).event(i).start()}).on("interrupt.zoom end.zoom",function(){x(this,arguments).event(i).end()}).tween("zoom",function(){var t=this,a=arguments,o=x(t,a).event(i),s=r.apply(t,a),c=null==n?y(s):"function"==typeof n?n.apply(t,a):n,l=Math.max(s[1][0]-s[0][0],s[1][1]-s[0][1]),u=t.__zoom,h="function"==typeof e?e.apply(t,a):e,f=d(u.invert(c).concat(l/u.k),h.invert(c).concat(l/h.k));return function(t){if(1===t)t=h;else{var e=f(t),n=l/e[2];t=new si(n,c[0]-e[0]*n,c[1]-e[1]*n)}o.zoom(null,t)}})}function x(t,e,n){return!n&&t.__zooming||new b(t,e)}function b(t,e){this.that=t,this.args=e,this.active=0,this.sourceEvent=null,this.extent=r.apply(t,e),this.taps=0}function _(t,...e){if(i.apply(this,arguments)){var n=x(this,e).event(t),r=this.__zoom,s=Math.max(c[0],Math.min(c[1],r.k*Math.pow(2,o.apply(this,arguments)))),u=kn(t);if(n.wheel)n.mouse[0][0]===u[0]&&n.mouse[0][1]===u[1]||(n.mouse[1]=r.invert(n.mouse[0]=u)),clearTimeout(n.wheel);else{if(r.k===s)return;n.mouse=[u,r.invert(u)],Wt(this),n.start()}ui(t),n.wheel=setTimeout(function(){n.wheel=null,n.end()},150),n.zoom("mouse",a(m(g(r,s),n.mouse[0],n.mouse[1]),n.extent,l))}}function k(t,...e){if(!n&&i.apply(this,arguments)){var r=t.currentTarget,o=x(this,e,!0).event(t),s=_n(t.view).on("mousemove.zoom",function(t){if(ui(t),!o.moved){var e=t.clientX-u,n=t.clientY-d;o.moved=e*e+n*n>f}o.event(t).zoom("mouse",a(m(o.that.__zoom,o.mouse[0]=kn(t,r),o.mouse[1]),o.extent,l))},!0).on("mouseup.zoom",function(t){s.on("mousemove.zoom mouseup.zoom",null),$n(t.view,o.moved),ui(t),o.event(t).end()},!0),c=kn(t,r),u=t.clientX,d=t.clientY;En(t.view),li(t),o.mouse=[c,this.__zoom.invert(c)],Wt(this),o.start()}}function M(t,...e){if(i.apply(this,arguments)){var n=this.__zoom,o=kn(t.changedTouches?t.changedTouches[0]:t,this),s=n.invert(o),c=n.k*(t.shiftKey?.5:2),d=a(m(g(n,c),o,s),r.apply(this,e),l);ui(t),u>0?_n(this).transition().duration(u).call(w,d,o,t):_n(this).call(v.transform,d,o,t)}}function S(n,...r){if(i.apply(this,arguments)){var a,o,s,c,l=n.touches,u=l.length,d=x(this,r,n.changedTouches.length===u).event(n);for(li(n),o=0;o<u;++o)c=[c=kn(s=l[o],this),this.__zoom.invert(c),s.identifier],d.touch0?d.touch1||d.touch0[2]===c[2]||(d.touch1=c,d.taps=0):(d.touch0=c,a=!0,d.taps=1+!!t);t&&(t=clearTimeout(t)),a&&(d.taps<2&&(e=c[0],t=setTimeout(function(){t=null},500)),Wt(this),d.start())}}function A(t,...e){if(this.__zooming){var n,i,r,o,s=x(this,e).event(t),c=t.changedTouches,u=c.length;for(ui(t),n=0;n<u;++n)r=kn(i=c[n],this),s.touch0&&s.touch0[2]===i.identifier?s.touch0[0]=r:s.touch1&&s.touch1[2]===i.identifier&&(s.touch1[0]=r);if(i=s.that.__zoom,s.touch1){var d=s.touch0[0],h=s.touch0[1],f=s.touch1[0],p=s.touch1[1],v=(v=f[0]-d[0])*v+(v=f[1]-d[1])*v,y=(y=p[0]-h[0])*y+(y=p[1]-h[1])*y;i=g(i,Math.sqrt(v/y)),r=[(d[0]+f[0])/2,(d[1]+f[1])/2],o=[(h[0]+p[0])/2,(h[1]+p[1])/2]}else{if(!s.touch0)return;r=s.touch0[0],o=s.touch0[1]}s.zoom("touch",a(m(i,r,o),s.extent,l))}}function I(t,...i){if(this.__zooming){var r,a,o=x(this,i).event(t),s=t.changedTouches,c=s.length;for(li(t),n&&clearTimeout(n),n=setTimeout(function(){n=null},500),r=0;r<c;++r)a=s[r],o.touch0&&o.touch0[2]===a.identifier?delete o.touch0:o.touch1&&o.touch1[2]===a.identifier&&delete o.touch1;if(o.touch1&&!o.touch0&&(o.touch0=o.touch1,delete o.touch1),o.touch0)o.touch0[1]=this.__zoom.invert(o.touch0[0]);else if(o.end(),2===o.taps&&(a=kn(a,this),Math.hypot(e[0]-a[0],e[1]-a[1])<p)){var l=_n(this).on("dblclick.zoom");l&&l.apply(this,arguments)}}}return v.transform=function(t,e,n,i){var r=t.selection?t.selection():t;r.property("__zoom",fi),t!==r?w(t,e,n,i):r.interrupt().each(function(){x(this,arguments).event(i).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()})},v.scaleBy=function(t,e,n,i){v.scaleTo(t,function(){return this.__zoom.k*("function"==typeof e?e.apply(this,arguments):e)},n,i)},v.scaleTo=function(t,e,n,i){v.transform(t,function(){var t=r.apply(this,arguments),i=this.__zoom,o=null==n?y(t):"function"==typeof n?n.apply(this,arguments):n,s=i.invert(o),c="function"==typeof e?e.apply(this,arguments):e;return a(m(g(i,c),o,s),t,l)},n,i)},v.translateBy=function(t,e,n,i){v.transform(t,function(){return a(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),r.apply(this,arguments),l)},null,i)},v.translateTo=function(t,e,n,i,o){v.transform(t,function(){var t=r.apply(this,arguments),o=this.__zoom,s=null==i?y(t):"function"==typeof i?i.apply(this,arguments):i;return a(ci.translate(s[0],s[1]).scale(o.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof n?-n.apply(this,arguments):-n),t,l)},i,o)},b.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1===++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0===--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var e=_n(this.that).datum();h.call(t,this.that,new oi(t,{sourceEvent:this.sourceEvent,target:v,type:t,transform:this.that.__zoom,dispatch:h}),e)}},v.wheelDelta=function(t){return arguments.length?(o="function"==typeof t?t:ai(+t),v):o},v.filter=function(t){return arguments.length?(i="function"==typeof t?t:ai(!!t),v):i},v.touchable=function(t){return arguments.length?(s="function"==typeof t?t:ai(!!t),v):s},v.extent=function(t){return arguments.length?(r="function"==typeof t?t:ai([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),v):r},v.scaleExtent=function(t){return arguments.length?(c[0]=+t[0],c[1]=+t[1],v):[c[0],c[1]]},v.translateExtent=function(t){return arguments.length?(l[0][0]=+t[0][0],l[1][0]=+t[1][0],l[0][1]=+t[0][1],l[1][1]=+t[1][1],v):[[l[0][0],l[0][1]],[l[1][0],l[1][1]]]},v.constrain=function(t){return arguments.length?(a=t,v):a},v.duration=function(t){return arguments.length?(u=+t,v):u},v.interpolate=function(t){return arguments.length?(d=t,v):d},v.on=function(){var t=h.on.apply(h,arguments);return t===h?v:t},v.clickDistance=function(t){return arguments.length?(f=(t=+t)*t,v):Math.sqrt(f)},v.tapDistance=function(t){return arguments.length?(p=+t,v):p},v}().scaleExtent([.1,4]).on("zoom",t=>{this.svg.select(".main-group").attr("transform",t.transform)});this.svg.call(a),this.svg.append("g").attr("class","main-group")}initializeSimulation(){this.simulation=function(t){var e,n=1,i=.001,r=1-Math.pow(i,1/300),a=0,o=.6,s=new Map,c=qt(d),l=St("tick","end"),u=function(){let t=1;return()=>(t=(1664525*t+1013904223)%Jn)/Jn}();function d(){h(),l.call("tick",e),n<i&&(c.stop(),l.call("end",e))}function h(i){var c,l,u=t.length;void 0===i&&(i=1);for(var d=0;d<i;++d)for(n+=(a-n)*r,s.forEach(function(t){t(n)}),c=0;c<u;++c)null==(l=t[c]).fx?l.x+=l.vx*=o:(l.x=l.fx,l.vx=0),null==l.fy?l.y+=l.vy*=o:(l.y=l.fy,l.vy=0);return e}function f(){for(var e,n=0,i=t.length;n<i;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),isNaN(e.x)||isNaN(e.y)){var r=10*Math.sqrt(.5+n),a=n*ti;e.x=r*Math.cos(a),e.y=r*Math.sin(a)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function p(e){return e.initialize&&e.initialize(t,u),e}return null==t&&(t=[]),f(),e={tick:h,restart:function(){return c.restart(d),e},stop:function(){return c.stop(),e},nodes:function(n){return arguments.length?(t=n,f(),s.forEach(p),e):t},alpha:function(t){return arguments.length?(n=+t,e):n},alphaMin:function(t){return arguments.length?(i=+t,e):i},alphaDecay:function(t){return arguments.length?(r=+t,e):+r},alphaTarget:function(t){return arguments.length?(a=+t,e):a},velocityDecay:function(t){return arguments.length?(o=1-t,e):1-o},randomSource:function(t){return arguments.length?(u=t,s.forEach(p),e):u},force:function(t,n){return arguments.length>1?(null==n?s.delete(t):s.set(t,p(n)),e):s.get(t)},find:function(e,n,i){var r,a,o,s,c,l=0,u=t.length;for(null==i?i=1/0:i*=i,l=0;l<u;++l)(o=(r=e-(s=t[l]).x)*r+(a=n-s.y)*a)<i&&(c=s,i=o);return c},on:function(t,n){return arguments.length>1?(l.on(t,n),e):l.on(t)}}}().force("link",function(t){var e,n,i,r,a,o,s=Zn,c=function(t){return 1/Math.min(r[t.source.index],r[t.target.index])},l=Xn(30),u=1;function d(i){for(var r=0,s=t.length;r<u;++r)for(var c,l,d,h,f,p,v,g=0;g<s;++g)l=(c=t[g]).source,h=(d=c.target).x+d.vx-l.x-l.vx||Un(o),f=d.y+d.vy-l.y-l.vy||Un(o),h*=p=((p=Math.sqrt(h*h+f*f))-n[g])/p*i*e[g],f*=p,d.vx-=h*(v=a[g]),d.vy-=f*v,l.vx+=h*(v=1-v),l.vy+=f*v}function h(){if(i){var o,c,l=i.length,u=t.length,d=new Map(i.map((t,e)=>[s(t,e,i),t]));for(o=0,r=new Array(l);o<u;++o)(c=t[o]).index=o,"object"!=typeof c.source&&(c.source=Wn(d,c.source)),"object"!=typeof c.target&&(c.target=Wn(d,c.target)),r[c.source.index]=(r[c.source.index]||0)+1,r[c.target.index]=(r[c.target.index]||0)+1;for(o=0,a=new Array(u);o<u;++o)c=t[o],a[o]=r[c.source.index]/(r[c.source.index]+r[c.target.index]);e=new Array(u),f(),n=new Array(u),p()}}function f(){if(i)for(var n=0,r=t.length;n<r;++n)e[n]=+c(t[n],n,t)}function p(){if(i)for(var e=0,r=t.length;e<r;++e)n[e]=+l(t[e],e,t)}return null==t&&(t=[]),d.initialize=function(t,e){i=t,o=e,h()},d.links=function(e){return arguments.length?(t=e,h(),d):t},d.id=function(t){return arguments.length?(s=t,d):s},d.iterations=function(t){return arguments.length?(u=+t,d):u},d.strength=function(t){return arguments.length?(c="function"==typeof t?t:Xn(+t),f(),d):c},d.distance=function(t){return arguments.length?(l="function"==typeof t?t:Xn(+t),p(),d):l},d}().id(t=>t.id).distance(100).strength(.8)).force("charge",function(){var t,e,n,i,r,a=Xn(-30),o=1,s=1/0,c=.81;function l(n){var r,a=t.length,o=On(t,Kn,Qn).visitAfter(d);for(i=n,r=0;r<a;++r)e=t[r],o.visit(h)}function u(){if(t){var e,n,i=t.length;for(r=new Array(i),e=0;e<i;++e)n=t[e],r[n.index]=+a(n,e,t)}}function d(t){var e,n,i,a,o,s=0,c=0;if(t.length){for(i=a=o=0;o<4;++o)(e=t[o])&&(n=Math.abs(e.value))&&(s+=e.value,c+=n,i+=n*e.x,a+=n*e.y);t.x=i/c,t.y=a/c}else{(e=t).x=e.data.x,e.y=e.data.y;do{s+=r[e.data.index]}while(e=e.next)}t.value=s}function h(t,a,l,u){if(!t.value)return!0;var d=t.x-e.x,h=t.y-e.y,f=u-a,p=d*d+h*h;if(f*f/c<p)return p<s&&(0===d&&(p+=(d=Un(n))*d),0===h&&(p+=(h=Un(n))*h),p<o&&(p=Math.sqrt(o*p)),e.vx+=d*t.value*i/p,e.vy+=h*t.value*i/p),!0;if(!(t.length||p>=s)){(t.data!==e||t.next)&&(0===d&&(p+=(d=Un(n))*d),0===h&&(p+=(h=Un(n))*h),p<o&&(p=Math.sqrt(o*p)));do{t.data!==e&&(f=r[t.data.index]*i/p,e.vx+=d*f,e.vy+=h*f)}while(t=t.next)}}return l.initialize=function(e,i){t=e,n=i,u()},l.strength=function(t){return arguments.length?(a="function"==typeof t?t:Xn(+t),u(),l):a},l.distanceMin=function(t){return arguments.length?(o=t*t,l):Math.sqrt(o)},l.distanceMax=function(t){return arguments.length?(s=t*t,l):Math.sqrt(s)},l.theta=function(t){return arguments.length?(c=t*t,l):Math.sqrt(c)},l}().strength(-400)).force("center",Dn(this.width/2,this.height/2)).force("collision",function(t){var e,n,i,r=1,a=1;function o(){for(var t,o,c,l,u,d,h,f=e.length,p=0;p<a;++p)for(o=On(e,Yn,Vn).visitAfter(s),t=0;t<f;++t)c=e[t],d=n[c.index],h=d*d,l=c.x+c.vx,u=c.y+c.vy,o.visit(v);function v(t,e,n,a,o){var s=t.data,f=t.r,p=d+f;if(!s)return e>l+p||a<l-p||n>u+p||o<u-p;if(s.index>c.index){var v=l-s.x-s.vx,g=u-s.y-s.vy,m=v*v+g*g;m<p*p&&(0===v&&(m+=(v=Un(i))*v),0===g&&(m+=(g=Un(i))*g),m=(p-(m=Math.sqrt(m)))/m*r,c.vx+=(v*=m)*(p=(f*=f)/(h+f)),c.vy+=(g*=m)*p,s.vx-=v*(p=1-p),s.vy-=g*p)}}}function s(t){if(t.data)return t.r=n[t.data.index];for(var e=t.r=0;e<4;++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function c(){if(e){var i,r,a=e.length;for(n=new Array(a),i=0;i<a;++i)r=e[i],n[r.index]=+t(r,i,e)}}return"function"!=typeof t&&(t=Xn(null==t?1:+t)),o.initialize=function(t,n){e=t,i=n,c()},o.iterations=function(t){return arguments.length?(a=+t,o):a},o.strength=function(t){return arguments.length?(r=+t,o):r},o.radius=function(e){return arguments.length?(t="function"==typeof e?e:Xn(+e),c(),o):t},o}().radius(35)).force("x",ei(this.width/2).strength(.1)).force("y",ni(this.height/2).strength(.1))}async loadIPRelationships(t,e,n){try{console.log("Loading IP relationships for:",t),console.log("IP Data:",e),console.log("Relationships:",n),this.buildGraphData(t,e,n),this.renderGraph()}catch(t){console.error("Failed to load IP relationships:",t),this.showError("Failed to load IP relationships")}}buildGraphData(t,e,n){this.nodes=[],this.links=[],console.log("Building graph data for:",t),this.nodes.push({id:t,name:e.name||"Root IP",type:"root",owner:e.owner||"Unknown",revenue:e.revenue||0,derivatives:n.filter(t=>"derivative"===t.type).length}),n.forEach(e=>{const n=e.target!==t?e.target:e.source;n&&n!==t&&(this.nodes.find(t=>t.id===n)||this.nodes.push({id:n,name:e.name||`IP ${n.slice(0,8)}...`,type:"derivative"===e.type?"child":"parent",owner:e.owner||"Unknown",revenue:e.revenue||0,derivatives:e.derivatives||0}),this.links.push({source:e.source,target:e.target,type:e.type,strength:1,revenue:e.revenue||0}))}),console.log("Built nodes:",this.nodes),console.log("Built links:",this.links),1===this.nodes.length&&this.addDemoNodes(t)}addDemoNodes(t){const e="0x"+Math.random().toString(16).substr(2,40);this.nodes.push({id:e,name:"Parent IP Asset",type:"parent",owner:"0x1234...5678",revenue:150,derivatives:3}),this.links.push({source:e,target:t,type:"parent",strength:1,revenue:25});for(let e=0;e<3;e++){const n="0x"+Math.random().toString(16).substr(2,40);this.nodes.push({id:n,name:`Derivative ${e+1}`,type:"child",owner:`0xabcd...${e}${e}${e}${e}`,revenue:50*Math.random(),derivatives:Math.floor(3*Math.random())}),this.links.push({source:t,target:n,type:"derivative",strength:1,revenue:20*Math.random()})}}renderGraph(){const t=this.svg.select(".main-group");t.selectAll("*").remove(),console.log("Rendering graph with nodes:",this.nodes.length,"links:",this.links.length),this.linkElements=t.append("g").attr("class","links").selectAll("line").data(this.links).enter().append("line").attr("stroke",t=>this.getLinkColor(t.type)).attr("stroke-width",t=>this.calculateLinkWidth(t.revenue||0)).attr("stroke-opacity",.7).attr("marker-end","url(#arrowhead)"),this.nodeElements=t.append("g").attr("class","nodes").selectAll("g").data(this.nodes).enter().append("g").attr("class","node").style("cursor","pointer").call(function(){var t,e,n,i,r=Tn,a=Rn,o=zn,s=Cn,c={},l=St("start","drag","end"),u=0,d=0;function h(t){t.on("mousedown.drag",f).filter(s).on("touchstart.drag",g).on("touchmove.drag",m,Mn).on("touchend.drag touchcancel.drag",y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function f(o,s){if(!i&&r.call(this,o,s)){var c=w(this,a.call(this,o,s),o,s,"mouse");c&&(_n(o.view).on("mousemove.drag",p,Sn).on("mouseup.drag",v,Sn),En(o.view),An(o),n=!1,t=o.clientX,e=o.clientY,c("start",o))}}function p(i){if(In(i),!n){var r=i.clientX-t,a=i.clientY-e;n=r*r+a*a>d}c.mouse("drag",i)}function v(t){_n(t.view).on("mousemove.drag mouseup.drag",null),$n(t.view,n),In(t),c.mouse("end",t)}function g(t,e){if(r.call(this,t,e)){var n,i,o=t.changedTouches,s=a.call(this,t,e),c=o.length;for(n=0;n<c;++n)(i=w(this,s,t,e,o[n].identifier,o[n]))&&(An(t),i("start",t,o[n]))}}function m(t){var e,n,i=t.changedTouches,r=i.length;for(e=0;e<r;++e)(n=c[i[e].identifier])&&(In(t),n("drag",t,i[e]))}function y(t){var e,n,r=t.changedTouches,a=r.length;for(i&&clearTimeout(i),i=setTimeout(function(){i=null},500),e=0;e<a;++e)(n=c[r[e].identifier])&&(An(t),n("end",t,r[e]))}function w(t,e,n,i,r,a){var s,d,f,p=l.copy(),v=kn(a||n,e);if(null!=(f=o.call(t,new Nn("beforestart",{sourceEvent:n,target:h,identifier:r,active:u,x:v[0],y:v[1],dx:0,dy:0,dispatch:p}),i)))return s=f.x-v[0]||0,d=f.y-v[1]||0,function n(a,o,l){var g,m=v;switch(a){case"start":c[r]=n,g=u++;break;case"end":delete c[r],--u;case"drag":v=kn(l||o,e),g=u}p.call(a,t,new Nn(a,{sourceEvent:o,subject:f,target:h,identifier:r,active:g,x:v[0]+s,y:v[1]+d,dx:v[0]-m[0],dy:v[1]-m[1],dispatch:p}),i)}}return h.filter=function(t){return arguments.length?(r="function"==typeof t?t:Pn(!!t),h):r},h.container=function(t){return arguments.length?(a="function"==typeof t?t:Pn(t),h):a},h.subject=function(t){return arguments.length?(o="function"==typeof t?t:Pn(t),h):o},h.touchable=function(t){return arguments.length?(s="function"==typeof t?t:Pn(!!t),h):s},h.on=function(){var t=l.on.apply(l,arguments);return t===l?h:t},h.clickDistance=function(t){return arguments.length?(d=(t=+t)*t,h):Math.sqrt(d)},h}().on("start",(t,e)=>this.dragStarted(t,e)).on("drag",(t,e)=>this.dragged(t,e)).on("end",(t,e)=>this.dragEnded(t,e))),this.nodeElements.append("circle").attr("r",t=>this.getNodeRadius(t.type)).attr("fill",t=>this.getNodeColor(t.type)).attr("stroke","#fff").attr("stroke-width",3).style("filter","drop-shadow(0 2px 4px rgba(0,0,0,0.1))"),this.nodeElements.append("text").text(t=>t.name.length>15?t.name.substring(0,15)+"...":t.name).attr("x",0).attr("y",t=>this.getNodeRadius(t.type)+18).attr("text-anchor","middle").attr("font-size","11px").attr("font-weight","600").attr("fill","#333").style("pointer-events","none"),this.nodeElements.filter(t=>t.revenue&&t.revenue>0).append("text").text(t=>`$${t.revenue?.toFixed(1)}`).attr("x",0).attr("y",t=>this.getNodeRadius(t.type)+32).attr("text-anchor","middle").attr("font-size","9px").attr("font-weight","500").attr("fill","#10b981").style("pointer-events","none"),this.nodeElements.on("click",(t,e)=>{this.handleNodeClick(t,e)}),this.nodeElements.on("mouseenter",(t,e)=>{this.handleNodeHover(t,e,!0)}).on("mouseleave",(t,e)=>{this.handleNodeHover(t,e,!1)}),this.nodeElements.append("title").text(t=>`${t.name}\nOwner: ${t.owner.slice(0,10)}...\nType: ${t.type}\nRevenue: $${t.revenue||0}\nDerivatives: ${t.derivatives||0}`),this.simulation.nodes(this.nodes),this.simulation.force("link").links(this.links),this.simulation.on("tick",()=>{this.linkElements.attr("x1",t=>t.source.x).attr("y1",t=>t.source.y).attr("x2",t=>t.target.x).attr("y2",t=>t.target.y),this.nodeElements.attr("transform",t=>`translate(${t.x},${t.y})`)}),this.simulation.alpha(1).restart()}handleNodeClick(t,e){console.log("Node clicked:",e),this.highlightConnectedNodes(e.id);const n=new CustomEvent("nodeClick",{detail:{node:e,event:t}});this.container.dispatchEvent(n)}handleNodeHover(t,e,n){const i=_n(t.currentTarget);n?i.select("circle").transition().duration(200).attr("r",1.2*this.getNodeRadius(e.type)).style("filter","drop-shadow(0 4px 8px rgba(0,0,0,0.2))"):i.select("circle").transition().duration(200).attr("r",this.getNodeRadius(e.type)).style("filter","drop-shadow(0 2px 4px rgba(0,0,0,0.1))")}highlightConnectedNodes(t){this.nodeElements.select("circle").attr("stroke-width",3).attr("stroke","#fff"),this.linkElements.attr("stroke-opacity",.3),this.nodeElements.filter(e=>e.id===t).select("circle").attr("stroke-width",4).attr("stroke","#ff6b6b");const e=this.links.filter(e=>e.source.id===t||e.target.id===t),n=new Set;e.forEach(t=>{n.add(t.source.id),n.add(t.target.id)}),this.nodeElements.filter(t=>n.has(t.id)).select("circle").attr("stroke-width",4).attr("stroke","#4ecdc4"),this.linkElements.filter(e=>e.source.id===t||e.target.id===t).attr("stroke-opacity",1)}getNodeColor(t){return{root:"url(#rootGradient)",parent:"url(#parentGradient)",child:"url(#childGradient)",derivative:"url(#derivativeGradient)"}[t]||"#6b7280"}getNodeRadius(t){return{root:22,parent:18,child:16,derivative:14}[t]||14}getLinkColor(t){return{parent:"#10b981",derivative:"#ef4444",license:"#3b82f6"}[t]||"#6b7280"}calculateLinkWidth(t=0){const e=Math.log10(t+1);return Math.min(8,1.5+2*e)}dragStarted(t,e){t.active||this.simulation.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}dragged(t,e){e.fx=t.x,e.fy=t.y}dragEnded(t,e){t.active||this.simulation.alphaTarget(0),e.fx=null,e.fy=null}showError(t){const e=this.svg.select(".main-group");e.selectAll("*").remove(),e.append("text").text(t).attr("x",this.width/2).attr("y",this.height/2).attr("text-anchor","middle").attr("font-size","14px").attr("fill","#ef4444")}showPlaceholder(){const t=this.svg.select(".main-group");t.selectAll("*").remove();const e=t.append("g").attr("class","placeholder").attr("transform",`translate(${this.width/2}, ${this.height/2})`);e.append("circle").attr("r",30).attr("fill","#f8f9fa").attr("stroke","#dee2e6").attr("stroke-width",2).attr("stroke-dasharray","5,5"),e.append("text").text("🎯").attr("text-anchor","middle").attr("font-size","24px").attr("y",8),e.append("text").text("Search for an IP Asset").attr("text-anchor","middle").attr("font-size","12px").attr("y",50).attr("fill","#6b7280"),e.append("text").text("to visualize relationships").attr("text-anchor","middle").attr("font-size","12px").attr("y",65).attr("fill","#6b7280")}clear(){this.nodes=[],this.links=[],this.simulation.nodes([]),this.simulation.force("link").links([]),this.showPlaceholder()}resize(){this.width=this.container.clientWidth||360,this.height=this.container.clientHeight||280,this.svg.attr("width",this.width).attr("height",this.height),this.simulation.force("center",Dn(this.width/2,this.height/2)).force("x",ei(this.width/2).strength(.1)).force("y",ni(this.height/2).strength(.1)).alpha(1).restart()}}class yi{constructor(){this.mockDatabase=new Map,this.relationshipDatabase=new Map,this.revenueDatabase=new Map,this.initializeMockData()}initializeMockData(){[{id:"0x1234567890123456789012345678901234567890",name:"Digital Art Masterpiece",owner:"0xabcd1234567890123456789012345678901234abcd",type:"Original Artwork",revenue:2450.75,derivatives:8,createdAt:"2024-01-15T10:30:00Z",totalRevenue:3200.5,monthlyRevenue:[150,280,420,380,290,310,450,380,290,310,280,250],licenseTerms:["Commercial Use","Attribution Required","Share Alike"],tags:["digital-art","nft","collectible","original"]},{id:"0x2345678901234567890123456789012345678901",name:"Remix Collection #1",owner:"0xbcde2345678901234567890123456789012345bcde",type:"Derivative Work",revenue:890.25,derivatives:3,createdAt:"2024-02-20T14:15:00Z",totalRevenue:1150.8,monthlyRevenue:[0,120,180,150,140,160,200,150,120,80,60,40],licenseTerms:["Non-Commercial","Attribution Required"],tags:["remix","derivative","music","creative"]},{id:"0x3456789012345678901234567890123456789012",name:"Commercial License Pro",owner:"0xcdef3456789012345678901234567890123456cdef",type:"License Agreement",revenue:1580.9,derivatives:0,createdAt:"2024-01-28T09:45:00Z",totalRevenue:1580.9,monthlyRevenue:[200,180,160,140,120,100,150,180,200,220,180,140],licenseTerms:["Full Commercial Rights","Worldwide Distribution"],tags:["license","commercial","business"]},{id:"0x4567890123456789012345678901234567890123",name:"NFT Collection Genesis",owner:"0xdefa4567890123456789012345678901234567defa",type:"NFT Collection",revenue:5240.6,derivatives:12,createdAt:"2023-12-10T16:20:00Z",totalRevenue:8900.3,monthlyRevenue:[800,750,680,720,650,580,620,680,720,780,850,920],licenseTerms:["Holder Rights","Commercial Use Allowed","Resale Rights"],tags:["nft","collection","pfp","community"]},{id:"0x5678901234567890123456789012345678901234",name:"Music Remix Track",owner:"0xefab5678901234567890123456789012345678efab",type:"Music Derivative",revenue:670.4,derivatives:2,createdAt:"2024-03-05T11:30:00Z",totalRevenue:820.15,monthlyRevenue:[0,0,80,120,100,90,110,130,120,100,80,60],licenseTerms:["Streaming Rights","Attribution Required"],tags:["music","remix","audio","streaming"]},{id:"0x6789012345678901234567890123456789012345",name:"AI Generated Art Series",owner:"0xfabc6789012345678901234567890123456789fabc",type:"AI Generated",revenue:1890.75,derivatives:6,createdAt:"2024-01-08T13:45:00Z",totalRevenue:2340.9,monthlyRevenue:[180,220,200,180,160,140,180,200,220,240,200,180],licenseTerms:["AI Disclosure Required","Commercial Use"],tags:["ai-art","generated","series","technology"]}].forEach(t=>{this.mockDatabase.set(t.id,t),this.revenueDatabase.set(t.id,{totalRevenue:t.totalRevenue||t.revenue||0,monthlyRevenue:t.monthlyRevenue||[],topEarningDerivatives:this.generateTopEarningDerivatives(t.derivatives||0),revenueBreakdown:{directSales:.6*(t.revenue||0),royalties:.3*(t.revenue||0),licensing:.1*(t.revenue||0)}})}),this.initializeRelationships()}generateTopEarningDerivatives(t){const e=[];for(let n=0;n<Math.min(t,5);n++){const t=500*Math.random()+50;e.push({id:"0x"+Math.random().toString(16).substr(2,40),name:`Top Derivative #${n+1}`,revenue:t,royaltyPaid:.1*t})}return e.sort((t,e)=>e.revenue-t.revenue)}initializeRelationships(){Object.entries({"0x1234567890123456789012345678901234567890":[{type:"derivative",source:"0x1234567890123456789012345678901234567890",target:"0x2345678901234567890123456789012345678901",name:"Remix Collection #1",owner:"0xbcde2345678901234567890123456789012345bcde",revenue:890.25,licenseType:"Creative Commons",royaltyRate:.15,createdAt:"2024-02-20T14:15:00Z"},{type:"license",source:"0x1234567890123456789012345678901234567890",target:"0x3456789012345678901234567890123456789012",name:"Commercial License Pro",owner:"0xcdef3456789012345678901234567890123456cdef",revenue:1580.9,licenseType:"Commercial",royaltyRate:.2,createdAt:"2024-01-28T09:45:00Z"},{type:"derivative",source:"0x1234567890123456789012345678901234567890",target:"0x5678901234567890123456789012345678901234",name:"Music Remix Track",owner:"0xefab5678901234567890123456789012345678efab",revenue:670.4,licenseType:"Attribution",royaltyRate:.12,createdAt:"2024-03-05T11:30:00Z"}],"0x4567890123456789012345678901234567890123":[{type:"derivative",source:"0x4567890123456789012345678901234567890123",target:"0x6789012345678901234567890123456789012345",name:"AI Generated Art Series",owner:"0xfabc6789012345678901234567890123456789fabc",revenue:1890.75,licenseType:"AI Commons",royaltyRate:.18,createdAt:"2024-01-08T13:45:00Z"}],"0x6789012345678901234567890123456789012345":[{type:"parent",source:"0x4567890123456789012345678901234567890123",target:"0x6789012345678901234567890123456789012345",name:"NFT Collection Genesis",owner:"0xdefa4567890123456789012345678901234567defa",revenue:5240.6,licenseType:"NFT Rights",royaltyRate:.25,createdAt:"2023-12-10T16:20:00Z"}]}).forEach(([t,e])=>{this.relationshipDatabase.set(t,e)})}async getIPAsset(t){await new Promise(t=>setTimeout(t,600+400*Math.random()));const e=this.mockDatabase.get(t);if(e)return e;const n=["Original Artwork","Derivative Work","License Agreement","NFT Collection","Music Track","AI Generated"];return{id:t,name:`IP Asset ${t.slice(0,8)}...`,owner:"0x"+Math.random().toString(16).substr(2,40),type:n[Math.floor(Math.random()*n.length)],revenue:1e3*Math.random(),derivatives:Math.floor(8*Math.random()),createdAt:new Date(Date.now()-365*Math.random()*24*60*60*1e3).toISOString(),totalRevenue:1500*Math.random(),monthlyRevenue:Array.from({length:12},()=>200*Math.random()),licenseTerms:["Standard License","Attribution Required"],tags:["generated","mock","test"],metadata:{title:`Sample IP Asset ${t.slice(0,8)}`,description:"This is a dynamically generated IP Asset for demonstration",createdAt:(new Date).toISOString(),tags:["digital","blockchain","ip"]}}}async getIPRelationships(t){await new Promise(t=>setTimeout(t,400+300*Math.random()));const e=this.relationshipDatabase.get(t);if(e)return e;const n=["parent","derivative","license","remix","commercial"],i=[],r=Math.floor(5*Math.random())+1;for(let e=0;e<r;e++){const r=n[Math.floor(Math.random()*n.length)],a="parent"===r,o="0x"+Math.random().toString(16).substr(2,40);i.push({type:r,source:a?o:t,target:a?t:o,name:`${r.charAt(0).toUpperCase()+r.slice(1)} ${e+1}`,owner:"0x"+Math.random().toString(16).substr(2,40),revenue:500*Math.random(),derivatives:Math.floor(4*Math.random()),licenseType:["Creative Commons","Commercial","Attribution","Share Alike"][Math.floor(4*Math.random())],royaltyRate:.3*Math.random(),createdAt:new Date(Date.now()-180*Math.random()*24*60*60*1e3).toISOString()})}return i}async getRevenueData(t){await new Promise(t=>setTimeout(t,500));const e=this.revenueDatabase.get(t);if(e)return e;const n=2e3*Math.random();return{totalRevenue:n,monthlyRevenue:Array.from({length:12},()=>200*Math.random()),topEarningDerivatives:this.generateTopEarningDerivatives(Math.floor(5*Math.random())),revenueBreakdown:{directSales:.6*n,royalties:.3*n,licensing:.1*n}}}async getRandomIP(){const t=Array.from(this.mockDatabase.keys());return t[Math.floor(Math.random()*t.length)]}async searchIPAssets(t){await new Promise(t=>setTimeout(t,300));const e=[];for(const[n,i]of this.mockDatabase)(n.toLowerCase().includes(t.toLowerCase())||i.name?.toLowerCase().includes(t.toLowerCase())||i.tags?.some(e=>e.toLowerCase().includes(t.toLowerCase())))&&e.push(i);for(;e.length<3;){const t=1e3*Math.random();e.push({id:"0x"+Math.random().toString(16).substr(2,40),name:`Search Result ${e.length+1}`,owner:"0x"+Math.random().toString(16).substr(2,40),type:"IP Asset",revenue:t,derivatives:Math.floor(5*Math.random()),totalRevenue:1.2*t,tags:["search","result","mock"]})}return e.slice(0,5)}async getIPAnalytics(t){await new Promise(t=>setTimeout(t,700));const e=await this.getRevenueData(t),n=await this.getIPRelationships(t);return{totalRevenue:e.totalRevenue,totalDerivatives:n.filter(t=>"derivative"===t.type).length,monthlyRevenue:e.monthlyRevenue,topDerivatives:e.topEarningDerivatives,revenueGrowth:this.calculateRevenueGrowth(e.monthlyRevenue),licenseTypes:n.map(t=>t.licenseType).filter(Boolean),averageRoyaltyRate:n.reduce((t,e)=>t+(e.royaltyRate||0),0)/n.length,creationTrend:this.generateCreationTrend(n)}}calculateRevenueGrowth(t){if(t.length<2)return 0;const e=t.slice(-3).reduce((t,e)=>t+e,0)/3,n=t.slice(-6,-3).reduce((t,e)=>t+e,0)/3;return n>0?(e-n)/n*100:0}generateCreationTrend(t){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].map(t=>({month:t,count:Math.floor(5*Math.random())}))}isValidIPId(t){return/^0x[a-fA-F0-9]{40}$/.test(t)}getNetworkInfo(){return{name:"Story Aeneid Testnet",chainId:"1315",explorer:"https://aeneid.storyscan.io"}}async getEcosystemOverview(){await new Promise(t=>setTimeout(t,800));const t=Array.from(this.mockDatabase.values()),e=t.reduce((t,e)=>t+(e.totalRevenue||0),0),n=t.reduce((t,e)=>t+(e.derivatives||0),0);return{totalIPs:t.length,totalRevenue:e,totalDerivatives:n,topPerformers:t.sort((t,e)=>(e.totalRevenue||0)-(t.totalRevenue||0)).slice(0,3),recentActivity:[{type:"derivative_created",ipId:"0x1234567890123456789012345678901234567890",timestamp:(new Date).toISOString()},{type:"license_granted",ipId:"0x4567890123456789012345678901234567890123",timestamp:new Date(Date.now()-36e5).toISOString()},{type:"revenue_received",ipId:"0x2345678901234567890123456789012345678901",timestamp:new Date(Date.now()-72e5).toISOString()}]}}}class wi{constructor(t){this.charts=new Map,this.container=t,this.data=this.initializeAnalyticsData(),this.setupEventListeners()}initializeAnalyticsData(){const t=localStorage.getItem("ip-graph-analytics");return t?JSON.parse(t):{totalIPs:0,totalRelationships:0,avgDerivatives:0,totalRevenue:0,searchCount:0,visualizationCount:0,topSearchedIPs:[],performanceMetrics:{avgLoadTime:0,successRate:100,errorRate:0},usageStats:{dailyActive:1,weeklyActive:1,totalSessions:1,avgSessionDuration:0},networkStats:{mostConnectedIP:{id:"",name:"",connections:0},largestNetwork:{rootId:"",nodeCount:0,depth:0},averageNetworkSize:0},revenueAnalytics:{totalEcosystemRevenue:0,averageIPRevenue:0,topRevenueGenerators:[],revenueDistribution:{original:0,derivatives:0,licenses:0}},timeSeriesData:{searchActivity:this.generateMockTimeSeriesData("search"),revenueGrowth:this.generateMockTimeSeriesData("revenue"),networkGrowth:this.generateMockTimeSeriesData("network")}}}generateMockTimeSeriesData(t){const e=[],n=new Date;for(let i=29;i>=0;i--){const r=new Date(n.getTime()-24*i*60*60*1e3);switch(t){case"search":e.push({date:r.toISOString().split("T")[0],searches:Math.floor(20*Math.random())+5,visualizations:Math.floor(15*Math.random())+3});break;case"revenue":e.push({month:r.toLocaleDateString("en",{month:"short"}),revenue:1e3*Math.random()+500,growth:20*(Math.random()-.5)});break;case"network":e.push({month:r.toLocaleDateString("en",{month:"short"}),newIPs:Math.floor(10*Math.random())+2,newRelationships:Math.floor(25*Math.random())+5})}}return e}render(){this.container.innerHTML=`\n      <div class="analytics-dashboard">\n        ${this.renderOverviewCards()}\n        ${this.renderPerformanceMetrics()}\n        ${this.renderUsageStatistics()}\n        ${this.renderNetworkAnalytics()}\n        ${this.renderRevenueAnalytics()}\n        ${this.renderTimeSeriesCharts()}\n        ${this.renderTopSearchedIPs()}\n      </div>\n    `,this.addStyles(),this.initializeCharts()}renderOverviewCards(){return`\n      <div class="overview-cards">\n        <div class="analytics-card primary">\n          <div class="card-icon">📊</div>\n          <div class="card-content">\n            <div class="card-value">${this.data.totalIPs.toLocaleString()}</div>\n            <div class="card-label">Total IPs Analyzed</div>\n            <div class="card-change positive">+${Math.floor(20*Math.random())}% this week</div>\n          </div>\n        </div>\n        \n        <div class="analytics-card secondary">\n          <div class="card-icon">🔗</div>\n          <div class="card-content">\n            <div class="card-value">${this.data.totalRelationships.toLocaleString()}</div>\n            <div class="card-label">Relationships Found</div>\n            <div class="card-change positive">+${Math.floor(15*Math.random())}% this week</div>\n          </div>\n        </div>\n        \n        <div class="analytics-card success">\n          <div class="card-icon">💰</div>\n          <div class="card-content">\n            <div class="card-value">$${this.data.totalRevenue.toLocaleString()}</div>\n            <div class="card-label">Total Revenue Tracked</div>\n            <div class="card-change positive">+${Math.floor(25*Math.random())}% this month</div>\n          </div>\n        </div>\n        \n        <div class="analytics-card info">\n          <div class="card-icon">🔍</div>\n          <div class="card-content">\n            <div class="card-value">${this.data.searchCount.toLocaleString()}</div>\n            <div class="card-label">Total Searches</div>\n            <div class="card-change neutral">${this.data.avgDerivatives.toFixed(1)} avg derivatives</div>\n          </div>\n        </div>\n      </div>\n    `}renderPerformanceMetrics(){return`\n      <div class="performance-section">\n        <h3>⚡ Performance Metrics</h3>\n        <div class="metrics-grid">\n          <div class="metric-item">\n            <div class="metric-label">Average Load Time</div>\n            <div class="metric-value">${this.data.performanceMetrics.avgLoadTime.toFixed(2)}s</div>\n            <div class="metric-bar">\n              <div class="metric-fill" style="width: ${Math.min(20*this.data.performanceMetrics.avgLoadTime,100)}%"></div>\n            </div>\n          </div>\n          \n          <div class="metric-item">\n            <div class="metric-label">Success Rate</div>\n            <div class="metric-value">${this.data.performanceMetrics.successRate.toFixed(1)}%</div>\n            <div class="metric-bar">\n              <div class="metric-fill success" style="width: ${this.data.performanceMetrics.successRate}%"></div>\n            </div>\n          </div>\n          \n          <div class="metric-item">\n            <div class="metric-label">Error Rate</div>\n            <div class="metric-value">${this.data.performanceMetrics.errorRate.toFixed(1)}%</div>\n            <div class="metric-bar">\n              <div class="metric-fill error" style="width: ${this.data.performanceMetrics.errorRate}%"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}renderUsageStatistics(){return`\n      <div class="usage-section">\n        <h3>👥 Usage Statistics</h3>\n        <div class="usage-stats">\n          <div class="usage-stat">\n            <div class="stat-icon">📅</div>\n            <div class="stat-content">\n              <div class="stat-value">${this.data.usageStats.dailyActive}</div>\n              <div class="stat-label">Daily Active</div>\n            </div>\n          </div>\n          \n          <div class="usage-stat">\n            <div class="stat-icon">📊</div>\n            <div class="stat-content">\n              <div class="stat-value">${this.data.usageStats.totalSessions}</div>\n              <div class="stat-label">Total Sessions</div>\n            </div>\n          </div>\n          \n          <div class="usage-stat">\n            <div class="stat-icon">⏱️</div>\n            <div class="stat-content">\n              <div class="stat-value">${Math.floor(this.data.usageStats.avgSessionDuration/60)}m</div>\n              <div class="stat-label">Avg Session</div>\n            </div>\n          </div>\n          \n          <div class="usage-stat">\n            <div class="stat-icon">🎯</div>\n            <div class="stat-content">\n              <div class="stat-value">${this.data.visualizationCount}</div>\n              <div class="stat-label">Visualizations</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}renderNetworkAnalytics(){return`\n      <div class="network-section">\n        <h3>🌐 Network Analytics</h3>\n        <div class="network-stats">\n          <div class="network-stat-card">\n            <h4>Most Connected IP</h4>\n            <div class="network-detail">\n              <div class="ip-name">${this.data.networkStats.mostConnectedIP.name||"Digital Art Masterpiece"}</div>\n              <div class="ip-id">${this.data.networkStats.mostConnectedIP.id||"0x1234...7890"}</div>\n              <div class="connection-count">${this.data.networkStats.mostConnectedIP.connections||8} connections</div>\n            </div>\n          </div>\n          \n          <div class="network-stat-card">\n            <h4>Largest Network</h4>\n            <div class="network-detail">\n              <div class="network-size">${this.data.networkStats.largestNetwork.nodeCount||12} nodes</div>\n              <div class="network-depth">Depth: ${this.data.networkStats.largestNetwork.depth||4} levels</div>\n              <div class="network-root">Root: ${this.data.networkStats.largestNetwork.rootId.slice(0,10)||"0x4567...0123"}...</div>\n            </div>\n          </div>\n          \n          <div class="network-stat-card">\n            <h4>Average Network Size</h4>\n            <div class="network-detail">\n              <div class="avg-size">${this.data.networkStats.averageNetworkSize.toFixed(1)||"5.2"} nodes</div>\n              <div class="network-trend">📈 Growing</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}renderRevenueAnalytics(){const t=this.data.revenueAnalytics;return`\n      <div class="revenue-section">\n        <h3>💎 Revenue Analytics</h3>\n        <div class="revenue-overview">\n          <div class="revenue-total">\n            <div class="total-amount">$${t.totalEcosystemRevenue.toLocaleString()||"24,580"}</div>\n            <div class="total-label">Total Ecosystem Revenue</div>\n          </div>\n          \n          <div class="revenue-distribution">\n            <div class="distribution-item">\n              <span class="dist-label">Original Works</span>\n              <span class="dist-value">$${t.revenueDistribution.original.toLocaleString()||"15,200"}</span>\n              <div class="dist-bar">\n                <div class="dist-fill original" style="width: ${t.revenueDistribution.original/t.totalEcosystemRevenue*100||62}%"></div>\n              </div>\n            </div>\n            \n            <div class="distribution-item">\n              <span class="dist-label">Derivatives</span>\n              <span class="dist-value">$${t.revenueDistribution.derivatives.toLocaleString()||"7,380"}</span>\n              <div class="dist-bar">\n                <div class="dist-fill derivative" style="width: ${t.revenueDistribution.derivatives/t.totalEcosystemRevenue*100||30}%"></div>\n              </div>\n            </div>\n            \n            <div class="distribution-item">\n              <span class="dist-label">Licenses</span>\n              <span class="dist-value">$${t.revenueDistribution.licenses.toLocaleString()||"2,000"}</span>\n              <div class="dist-bar">\n                <div class="dist-fill license" style="width: ${t.revenueDistribution.licenses/t.totalEcosystemRevenue*100||8}%"></div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}renderTimeSeriesCharts(){return'\n      <div class="charts-section">\n        <h3>📈 Activity Trends</h3>\n        <div class="charts-container">\n          <div class="chart-card">\n            <h4>Search Activity (Last 30 Days)</h4>\n            <div id="search-activity-chart" class="chart-placeholder">\n              <div class="chart-loading">Loading chart...</div>\n            </div>\n          </div>\n          \n          <div class="chart-card">\n            <h4>Network Growth</h4>\n            <div id="network-growth-chart" class="chart-placeholder">\n              <div class="chart-loading">Loading chart...</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    '}renderTopSearchedIPs(){return`\n      <div class="top-searches-section">\n        <h3>🔥 Most Searched IPs</h3>\n        <div class="top-searches-list">\n          ${(this.data.topSearchedIPs.length>0?this.data.topSearchedIPs:[{id:"0x1234567890123456789012345678901234567890",name:"Digital Art Masterpiece",searchCount:15,lastSearched:"2024-08-05T10:30:00Z"},{id:"0x4567890123456789012345678901234567890123",name:"NFT Collection Genesis",searchCount:12,lastSearched:"2024-08-05T09:15:00Z"},{id:"0x6789012345678901234567890123456789012345",name:"AI Generated Art Series",searchCount:8,lastSearched:"2024-08-05T08:45:00Z"}]).map((t,e)=>`\n            <div class="search-item" data-ip-id="${t.id}">\n              <div class="search-rank">#${e+1}</div>\n              <div class="search-details">\n                <div class="search-name">${t.name}</div>\n                <div class="search-id">${t.id.slice(0,10)}...${t.id.slice(-8)}</div>\n                <div class="search-meta">\n                  <span class="search-count">${t.searchCount} searches</span>\n                  <span class="last-searched">Last: ${new Date(t.lastSearched).toLocaleDateString()}</span>\n                </div>\n              </div>\n              <div class="search-actions">\n                <button class="search-again-btn" data-ip-id="${t.id}">🔍</button>\n              </div>\n            </div>\n          `).join("")}\n        </div>\n      </div>\n    `}initializeCharts(){this.renderSearchActivityChart(),this.renderNetworkGrowthChart()}renderSearchActivityChart(){const t=document.getElementById("search-activity-chart");if(!t)return;const e=this.data.timeSeriesData.searchActivity.slice(-7),n=Math.max(...e.map(t=>Math.max(t.searches,t.visualizations)));t.innerHTML=`\n      <div class="simple-chart">\n        ${e.map((t,e)=>`\n          <div class="chart-day">\n            <div class="chart-bars">\n              <div class="chart-bar searches" style="height: ${t.searches/n*100}%" title="Searches: ${t.searches}"></div>\n              <div class="chart-bar visualizations" style="height: ${t.visualizations/n*100}%" title="Visualizations: ${t.visualizations}"></div>\n            </div>\n            <div class="chart-label">${new Date(t.date).toLocaleDateString("en",{weekday:"short"})}</div>\n          </div>\n        `).join("")}\n      </div>\n      <div class="chart-legend">\n        <div class="legend-item">\n          <div class="legend-color searches"></div>\n          <span>Searches</span>\n        </div>\n        <div class="legend-item">\n          <div class="legend-color visualizations"></div>\n          <span>Visualizations</span>\n        </div>\n      </div>\n    `}renderNetworkGrowthChart(){const t=document.getElementById("network-growth-chart");if(!t)return;const e=this.data.timeSeriesData.networkGrowth.slice(-6),n=Math.max(...e.map(t=>Math.max(t.newIPs,t.newRelationships)));t.innerHTML=`\n      <div class="simple-chart">\n        ${e.map((t,e)=>`\n          <div class="chart-month">\n            <div class="chart-bars">\n              <div class="chart-bar new-ips" style="height: ${t.newIPs/n*100}%" title="New IPs: ${t.newIPs}"></div>\n              <div class="chart-bar new-relationships" style="height: ${t.newRelationships/n*100}%" title="New Relationships: ${t.newRelationships}"></div>\n            </div>\n            <div class="chart-label">${t.month}</div>\n          </div>\n        `).join("")}\n      </div>\n      <div class="chart-legend">\n        <div class="legend-item">\n          <div class="legend-color new-ips"></div>\n          <span>New IPs</span>\n        </div>\n        <div class="legend-item">\n          <div class="legend-color new-relationships"></div>\n          <span>New Relationships</span>\n        </div>\n      </div>\n    `}setupEventListeners(){document.addEventListener("click",t=>{const e=t.target;if(e.classList.contains("search-again-btn")){const t=e.getAttribute("data-ip-id");t&&this.handleSearchAgain(t)}})}handleSearchAgain(t){const e=new CustomEvent("searchIP",{detail:{ipId:t}});document.dispatchEvent(e)}trackSearch(t,e){this.data.searchCount++,this.data.totalIPs++;const n=this.data.topSearchedIPs.findIndex(e=>e.id===t);n>=0?(this.data.topSearchedIPs[n].searchCount++,this.data.topSearchedIPs[n].lastSearched=(new Date).toISOString()):this.data.topSearchedIPs.push({id:t,name:e,searchCount:1,lastSearched:(new Date).toISOString()}),this.data.topSearchedIPs.sort((t,e)=>e.searchCount-t.searchCount),this.data.topSearchedIPs=this.data.topSearchedIPs.slice(0,10),this.saveData()}trackVisualization(t){this.data.visualizationCount++,this.data.totalRelationships+=t,this.data.avgDerivatives=this.data.totalRelationships/this.data.totalIPs,this.saveData()}trackPerformance(t,e){const n=this.data.performanceMetrics.avgLoadTime,i=this.data.searchCount;this.data.performanceMetrics.avgLoadTime=(n*(i-1)+t)/i,e?this.data.performanceMetrics.successRate=(this.data.performanceMetrics.successRate*(i-1)+100)/i:this.data.performanceMetrics.errorRate=(this.data.performanceMetrics.errorRate*(i-1)+100)/i,this.saveData()}updateRevenue(t){this.data.totalRevenue+=t,this.data.revenueAnalytics.totalEcosystemRevenue+=t,this.data.revenueAnalytics.averageIPRevenue=this.data.revenueAnalytics.totalEcosystemRevenue/this.data.totalIPs,this.saveData()}saveData(){localStorage.setItem("ip-graph-analytics",JSON.stringify(this.data))}exportData(){return JSON.stringify(this.data,null,2)}clearData(){localStorage.removeItem("ip-graph-analytics"),this.data=this.initializeAnalyticsData(),this.render()}addStyles(){if(document.getElementById("analytics-dashboard-styles"))return;const t=document.createElement("style");t.id="analytics-dashboard-styles",t.textContent="\n      .analytics-dashboard {\n        padding: 20px;\n        background: #f8f9fa;\n        border-radius: 12px;\n        margin: 15px 0;\n      }\n\n      .overview-cards {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n        gap: 15px;\n        margin-bottom: 25px;\n      }\n\n      .analytics-card {\n        background: white;\n        border-radius: 12px;\n        padding: 20px;\n        display: flex;\n        align-items: center;\n        gap: 15px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n        transition: transform 0.2s ease;\n      }\n\n      .analytics-card:hover {\n        transform: translateY(-2px);\n      }\n\n      .analytics-card.primary { border-left: 4px solid #667eea; }\n      .analytics-card.secondary { border-left: 4px solid #764ba2; }\n      .analytics-card.success { border-left: 4px solid #10b981; }\n      .analytics-card.info { border-left: 4px solid #3b82f6; }\n\n      .card-icon {\n        font-size: 24px;\n        opacity: 0.8;\n      }\n\n      .card-content {\n        flex: 1;\n      }\n\n      .card-value {\n        font-size: 24px;\n        font-weight: bold;\n        color: #333;\n        margin-bottom: 4px;\n      }\n\n      .card-label {\n        font-size: 12px;\n        color: #666;\n        margin-bottom: 4px;\n      }\n\n      .card-change {\n        font-size: 11px;\n        font-weight: 600;\n      }\n\n      .card-change.positive { color: #10b981; }\n      .card-change.negative { color: #ef4444; }\n      .card-change.neutral { color: #6b7280; }\n\n      .performance-section,\n      .usage-section,\n      .network-section,\n      .revenue-section,\n      .charts-section,\n      .top-searches-section {\n        background: white;\n        border-radius: 12px;\n        padding: 20px;\n        margin-bottom: 20px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n      }\n\n      .performance-section h3,\n      .usage-section h3,\n      .network-section h3,\n      .revenue-section h3,\n      .charts-section h3,\n      .top-searches-section h3 {\n        margin: 0 0 20px 0;\n        color: #333;\n        font-size: 16px;\n      }\n\n      .metrics-grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n        gap: 15px;\n      }\n\n      .metric-item {\n        padding: 15px;\n        background: #f8f9fa;\n        border-radius: 8px;\n      }\n\n      .metric-label {\n        font-size: 12px;\n        color: #666;\n        margin-bottom: 8px;\n      }\n\n      .metric-value {\n        font-size: 18px;\n        font-weight: bold;\n        color: #333;\n        margin-bottom: 10px;\n      }\n\n      .metric-bar {\n        height: 6px;\n        background: #e5e7eb;\n        border-radius: 3px;\n        overflow: hidden;\n      }\n\n      .metric-fill {\n        height: 100%;\n        background: #667eea;\n        transition: width 0.3s ease;\n      }\n\n      .metric-fill.success { background: #10b981; }\n      .metric-fill.error { background: #ef4444; }\n\n      .usage-stats {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n        gap: 15px;\n      }\n\n      .usage-stat {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        padding: 15px;\n        background: #f8f9fa;\n        border-radius: 8px;\n      }\n\n      .stat-icon {\n        font-size: 20px;\n        opacity: 0.8;\n      }\n\n      .stat-value {\n        font-size: 20px;\n        font-weight: bold;\n        color: #333;\n      }\n\n      .stat-label {\n        font-size: 11px;\n        color: #666;\n      }\n\n      .network-stats {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n        gap: 15px;\n      }\n\n      .network-stat-card {\n        padding: 15px;\n        background: #f8f9fa;\n        border-radius: 8px;\n      }\n\n      .network-stat-card h4 {\n        margin: 0 0 12px 0;\n        font-size: 14px;\n        color: #333;\n      }\n\n      .network-detail {\n        font-size: 12px;\n      }\n\n      .ip-name, .network-size, .avg-size {\n        font-weight: bold;\n        color: #333;\n        margin-bottom: 4px;\n      }\n\n      .ip-id, .network-depth, .network-root, .network-trend {\n        color: #666;\n        margin-bottom: 2px;\n      }\n\n      .revenue-overview {\n        display: grid;\n        grid-template-columns: 1fr 2fr;\n        gap: 20px;\n        align-items: start;\n      }\n\n      .revenue-total {\n        text-align: center;\n        padding: 20px;\n        background: linear-gradient(135deg, #667eea, #764ba2);\n        color: white;\n        border-radius: 12px;\n      }\n\n      .total-amount {\n        font-size: 28px;\n        font-weight: bold;\n        margin-bottom: 8px;\n      }\n\n      .total-label {\n        font-size: 12px;\n        opacity: 0.9;\n      }\n\n      .revenue-distribution {\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n\n      .distribution-item {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n      }\n\n      .dist-label {\n        flex: 1;\n        font-size: 12px;\n        color: #666;\n      }\n\n      .dist-value {\n        font-size: 12px;\n        font-weight: 600;\n        color: #333;\n        min-width: 80px;\n        text-align: right;\n      }\n\n      .dist-bar {\n        flex: 2;\n        height: 8px;\n        background: #e5e7eb;\n        border-radius: 4px;\n        overflow: hidden;\n      }\n\n      .dist-fill {\n        height: 100%;\n        transition: width 0.3s ease;\n      }\n\n      .dist-fill.original { background: #667eea; }\n      .dist-fill.derivative { background: #10b981; }\n      .dist-fill.license { background: #f59e0b; }\n\n      .charts-container {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n        gap: 20px;\n      }\n\n      .chart-card {\n        background: #f8f9fa;\n        border-radius: 8px;\n        padding: 15px;\n      }\n\n      .chart-card h4 {\n        margin: 0 0 15px 0;\n        font-size: 14px;\n        color: #333;\n      }\n\n      .chart-placeholder {\n        height: 200px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        background: white;\n        border-radius: 6px;\n      }\n\n      .simple-chart {\n        display: flex;\n        align-items: end;\n        gap: 8px;\n        height: 150px;\n        padding: 10px;\n      }\n\n      .chart-day, .chart-month {\n        flex: 1;\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        gap: 5px;\n      }\n\n      .chart-bars {\n        display: flex;\n        align-items: end;\n        gap: 2px;\n        height: 120px;\n      }\n\n      .chart-bar {\n        width: 12px;\n        border-radius: 2px 2px 0 0;\n        min-height: 2px;\n        transition: all 0.3s ease;\n      }\n\n      .chart-bar.searches, .chart-bar.new-ips { background: #667eea; }\n      .chart-bar.visualizations, .chart-bar.new-relationships { background: #10b981; }\n\n      .chart-label {\n        font-size: 10px;\n        color: #666;\n        text-align: center;\n      }\n\n      .chart-legend {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-top: 10px;\n      }\n\n      .legend-item {\n        display: flex;\n        align-items: center;\n        gap: 6px;\n        font-size: 11px;\n        color: #666;\n      }\n\n      .legend-color {\n        width: 12px;\n        height: 12px;\n        border-radius: 2px;\n      }\n\n      .legend-color.searches, .legend-color.new-ips { background: #667eea; }\n      .legend-color.visualizations, .legend-color.new-relationships { background: #10b981; }\n\n      .top-searches-list {\n        display: flex;\n        flex-direction: column;\n        gap: 10px;\n      }\n\n      .search-item {\n        display: flex;\n        align-items: center;\n        gap: 15px;\n        padding: 15px;\n        background: #f8f9fa;\n        border-radius: 8px;\n        cursor: pointer;\n        transition: background 0.2s ease;\n      }\n\n      .search-item:hover {\n        background: #e9ecef;\n      }\n\n      .search-rank {\n        font-size: 16px;\n        font-weight: bold;\n        color: #667eea;\n        min-width: 30px;\n      }\n\n      .search-details {\n        flex: 1;\n      }\n\n      .search-name {\n        font-size: 13px;\n        font-weight: 600;\n        color: #333;\n        margin-bottom: 4px;\n      }\n\n      .search-id {\n        font-size: 11px;\n        font-family: monospace;\n        color: #666;\n        margin-bottom: 4px;\n      }\n\n      .search-meta {\n        display: flex;\n        gap: 15px;\n        font-size: 10px;\n        color: #888;\n      }\n\n      .search-actions {\n        display: flex;\n        gap: 8px;\n      }\n\n      .search-again-btn {\n        background: #667eea;\n        color: white;\n        border: none;\n        border-radius: 6px;\n        padding: 8px 12px;\n        cursor: pointer;\n        font-size: 12px;\n        transition: background 0.2s ease;\n      }\n\n      .search-again-btn:hover {\n        background: #5a67d8;\n      }\n\n      @media (max-width: 768px) {\n        .overview-cards {\n          grid-template-columns: 1fr;\n        }\n        \n        .revenue-overview {\n          grid-template-columns: 1fr;\n        }\n        \n        .charts-container {\n          grid-template-columns: 1fr;\n          max-width: 100%;\n          overflow-x: auto;\n        }\n      }\n    ",document.head.appendChild(t)}}const xi=t.p+"assets/5aa84849832f7c5978fb.png";let bi=null,_i=null,ki=null,Mi={totalIPs:0,totalRelationships:0,avgDerivatives:0};async function Si(t){if(!bi||!_i)return;const e=performance.now();let n=!1;try{Ii(!0);const e=await _i.getIPAsset(t),i=await _i.getIPRelationships(t);ki&&(ki.trackSearch(t,e.name||"Unknown IP"),ki.trackVisualization(i.length),ki.updateRevenue(e.revenue||0)),Mi.totalIPs++,Mi.totalRelationships+=i.length,Mi.avgDerivatives=Mi.totalRelationships/Mi.totalIPs,function(){const t=document.getElementById("total-ips"),e=document.getElementById("total-relationships"),n=document.getElementById("avg-derivatives");if(t&&(t.textContent=Mi.totalIPs.toString()),e&&(e.textContent=Mi.totalRelationships.toString()),n){const t=Mi.totalIPs>0?(Mi.totalRelationships/Mi.totalIPs).toFixed(1):"0";n.textContent=t}}(),await bi.loadIPRelationships(t,e,i),function(t,e){const n=document.getElementById("ip-details");if(!n)return;let i=`\n    <div class="ip-info">\n      <h3>📋 IP Asset Details</h3>\n      <div class="info-grid">\n        <div class="info-item">\n          <span class="label">ID:</span>\n          <span class="value">${t.id}</span>\n        </div>\n        <div class="info-item">\n          <span class="label">Owner:</span>\n          <span class="value">${t.owner||"Unknown"}</span>\n        </div>\n        <div class="info-item">\n          <span class="label">Type:</span>\n          <span class="value">${t.type||"IP Asset"}</span>\n        </div>\n        <div class="info-item">\n          <span class="label">Derivatives:</span>\n          <span class="value">${e.filter(t=>"derivative"===t.type).length}</span>\n        </div>\n      </div>\n    </div>\n  `;e.length>0&&(i+=`\n      <div class="relationships">\n        <h4>🔗 Relationships (${e.length})</h4>\n        <div class="relationship-list">\n    `,e.forEach(t=>{i+=`\n        <div class="relationship-item">\n          <span class="rel-type">${t.type}</span>\n          <span class="rel-target">${t.target}</span>\n        </div>\n      `}),i+="\n        </div>\n      </div>\n    "),n.innerHTML=i}(e,i),n=!0,Ii(!1)}catch(t){console.error("Failed to analyze IP:",t),function(){const t=document.getElementById("ip-details");t&&(t.innerHTML='\n      <div class="error-message">\n        <span class="error-icon">❌</span>\n        <p>Failed to analyze IP. Please check the ID and try again.</p>\n      </div>\n    ')}(),Ii(!1)}finally{const t=(performance.now()-e)/1e3;ki&&ki.trackPerformance(t,n)}}function Ai(){bi&&bi.clear();const t=document.getElementById("ip-details");t&&(t.innerHTML='\n      <div class="placeholder">\n        <span class="placeholder-icon">🎯</span>\n        <p>Search for an IP Asset to see its relationship graph</p>\n      </div>\n    ');const e=document.getElementById("search");e&&(e.value="")}function Ii(t){const e=document.getElementById("graph-loading");e&&e.classList.toggle("hidden",!t)}function Ei(t){const e=document.createElement("div");e.className="detected-ips-panel",e.innerHTML=`\n    <div class="detected-header">\n      <span class="detected-icon">🔍</span>\n      <span class="detected-title">Detected IPs (${t.length})</span>\n      <button class="detected-close">✕</button>\n    </div>\n    <div class="detected-list">\n      ${t.slice(0,10).map((t,e)=>`\n        <div class="detected-item" data-ip="${t.ip}">\n          <div class="detected-ip">${t.ip.slice(0,12)}...${t.ip.slice(-8)}</div>\n          <div class="detected-type">${t.type}</div>\n          <div class="detected-context">${t.context?.slice(0,40)}...</div>\n          <button class="analyze-ip-btn" data-ip="${t.ip}">🔍</button>\n        </div>\n      `).join("")}\n      ${t.length>10?`<div class="detected-more">+${t.length-10} more IPs detected</div>`:""}\n    </div>\n  `,e.style.cssText="\n    background: white;\n    border: 1px solid #e5e7eb;\n    border-radius: 8px;\n    margin: 10px 0;\n    max-height: 300px;\n    overflow-y: auto;\n  ";const n=document.querySelector(".search-section");n&&n.parentNode?.insertBefore(e,n.nextSibling),e.querySelectorAll(".analyze-ip-btn").forEach(t=>{t.addEventListener("click",e=>{e.stopPropagation();const n=t.getAttribute("data-ip");if(n){const t=document.getElementById("search");t&&(t.value=n,Si(n))}})});const i=e.querySelector(".detected-close");i?.addEventListener("click",()=>{e.remove()})}document.addEventListener("DOMContentLoaded",async()=>{console.log("IP Graph Extension popup loaded"),"true"===localStorage.getItem("darkMode")&&document.body.classList.add("dark-mode");const t=document.getElementById("logo-icon");t&&(t.src=xi),function(){const t=document.querySelectorAll(".tab-button"),e=document.querySelectorAll(".tab-content");t.forEach(n=>{n.addEventListener("click",i=>{const r=i.target.getAttribute("data-tab");t.forEach(t=>t.classList.remove("active")),e.forEach(t=>t.classList.remove("active")),n.classList.add("active");const a=document.getElementById(r);a&&a.classList.add("active")})})}(),function(){const t=document.getElementById("search"),e=document.getElementById("visualize"),n=document.getElementById("random-ip"),i=document.getElementById("clear-graph");e?.addEventListener("click",async()=>{const e=t?.value.trim();e&&await Si(e)}),t?.addEventListener("keypress",async e=>{if("Enter"===e.key){const e=t.value.trim();e&&await Si(e)}}),n?.addEventListener("click",async()=>{const e=await async function(){if(!_i)return null;try{return await _i.getRandomIP()}catch(t){return console.error("Failed to get random IP:",t),null}}();e&&t&&(t.value=e,await Si(e))}),i?.addEventListener("click",()=>{Ai()})}(),function(){const t=document.getElementById("connect-wallet"),s=document.getElementById("disconnect-wallet");t?.addEventListener("click",async()=>{try{await async function(){try{if(a("connecting","Connecting to MetaMask..."),void 0===window.ethereum)throw new Error("MetaMask not found. Please install MetaMask extension.");const t=window.ethereum,s=await t.request({method:"eth_requestAccounts"});if(0===s.length)throw new Error("No accounts found. Please unlock your wallet.");const c=s[0],l=await t.request({method:"eth_chainId"});parseInt(l,16)!==n&&await async function(t){try{await t.request({method:"wallet_switchEthereumChain",params:[{chainId:`0x${n.toString(16)}`}]})}catch(e){if(4902!==e.code)throw e;await t.request({method:"wallet_addEthereumChain",params:[{chainId:`0x${n.toString(16)}`,chainName:"Story Aeneid Testnet",nativeCurrency:{name:"IP",symbol:"IP",decimals:18},rpcUrls:["https://aeneid.storyrpc.io"],blockExplorerUrls:["https://aeneid.storyscan.io"]}]})}}(t);const u=await t.request({method:"eth_getBalance",params:[c,"latest"]}),d=parseInt(u,16)/Math.pow(10,18);e={address:c,balance:d.toFixed(4),connected:!0,chainId:n,provider:"MetaMask",network:"Story Aeneid Testnet"},a("connected","Connected to Story Protocol"),r(),await async function(){if(e?.connected)try{!function(t){const e=document.getElementById("ip-details");if(!e)return;let n='<div class="user-assets">';n+="<h3>📋 Your Story IP Assets</h3>",0===t.length?n+="<p>You don't own any IP Assets on Story Protocol yet.</p>":(n+='<div class="assets-list">',t.forEach(t=>{n+=`\n        <div class="asset-item" data-ip-id="${t.id}">\n          <div class="asset-name">${t.name||"Unnamed IP"}</div>\n          <div class="asset-id">${t.id.slice(0,10)}...${t.id.slice(-8)}</div>\n          <div class="asset-stats">\n            <span>📊 Derivatives: ${t.derivatives?.length||0}</span>\n            <span>💰 Revenue: ${t.totalRevenue||"0"} IP</span>\n          </div>\n        </div>\n      `}),n+="</div>"),n+="</div>",e.innerHTML=n,document.querySelectorAll(".asset-item").forEach(t=>{t.addEventListener("click",t=>{const e=t.currentTarget.getAttribute("data-ip-id");e&&function(t){const e=document.getElementById("search"),n=document.getElementById("visualize");e&&(e.value=t),n&&n.click()}(e)})})}([{id:"0x1234567890123456789012345678901234567890",name:"My Story IP #1",derivatives:[],totalRevenue:"12.5"},{id:"0x2345678901234567890123456789012345678901",name:"Creative Collection",derivatives:[{id:"0x3456"},{id:"0x7890"}],totalRevenue:"28.7"},{id:"0x3456789012345678901234567890123456789012",name:"Digital Art Series",derivatives:[{id:"0xabcd"}],totalRevenue:"15.3"}])}catch(t){console.error("Failed to load user IP assets:",t)}}(),function(){const t=o("✅ Connected to Story Protocol!","success");document.body.appendChild(t),setTimeout(()=>{t.remove()},3e3)}(),function(t){t.on("accountsChanged",t=>{if(0===t.length)i();else{const n=t[0];e&&(e.address=n,r())}}),t.on("chainChanged",t=>{parseInt(t,16)!==n&&function(){const t=o("⚠️ Please switch to Story Aeneid Testnet","error");document.body.appendChild(t),setTimeout(()=>{t.remove()},5e3)}()})}(t)}catch(t){console.error("Wallet connection failed:",t),a("error","Connection failed"),function(t){let e="Connection failed. Please try again.";t.message&&(t.message.includes("User rejected")?e="Connection cancelled by user.":t.message.includes("MetaMask not found")?e="Please install MetaMask extension.":t.message.includes("No accounts found")&&(e="Please unlock your wallet and try again."));const n=o(`❌ ${e}`,"error");document.body.appendChild(n),setTimeout(()=>{n.remove()},4e3)}(t)}}()}catch(t){console.error("Failed to connect wallet:",t)}}),s?.addEventListener("click",async()=>{try{await async function(){try{i()}catch(t){console.error("Error disconnecting:",t)}}()}catch(t){console.error("Failed to disconnect wallet:",t)}})}(),function(){const t=document.getElementById("analytics-content");t&&(ki=new wi(t),ki.render()),document.addEventListener("searchIP",t=>{const{ipId:e}=t.detail,n=document.getElementById("search");n&&(n.value=e,Si(e))})}(),_i=new yi;const s=document.getElementById("graph-canvas");s&&(bi=new mi(s)),async function(){try{const t=await chrome.runtime.sendMessage({action:"getStoredIP"});if(console.log("Stored IP data:",t),t.selectedIP){const e=document.getElementById("search");e&&(e.value=t.selectedIP,t.fromContextMenu&&function(t){const e=document.createElement("div");e.className="context-info-panel",e.innerHTML=`\n    <div class="context-header">\n      <span class="context-icon">🎯</span>\n      <span class="context-title">IP Detected from Context Menu</span>\n      <button class="context-close">✕</button>\n    </div>\n    <div class="context-details">\n      ${t.sourceTitle?`<div class="context-item"><strong>Source:</strong> ${t.sourceTitle}</div>`:""}\n      ${t.sourceUrl?`<div class="context-item"><strong>URL:</strong> ${t.sourceUrl}</div>`:""}\n      ${t.ipType?`<div class="context-item"><strong>Type:</strong> ${t.ipType}</div>`:""}\n      ${t.selectionContext?`<div class="context-item"><strong>Context:</strong> "${t.selectionContext}"</div>`:""}\n      <div class="context-item"><strong>Detected:</strong> ${new Date(t.timestamp).toLocaleString()}</div>\n    </div>\n  `,e.style.cssText="\n    background: linear-gradient(135deg, #667eea, #764ba2);\n    color: white;\n    border-radius: 8px;\n    padding: 15px;\n    margin: 10px 0;\n    font-size: 12px;\n  ";const n=document.querySelector(".search-section");n&&n.parentNode?.insertBefore(e,n);const i=e.querySelector(".context-close");i?.addEventListener("click",()=>{e.remove()}),setTimeout(()=>{e.parentNode&&e.remove()},1e4)}(t),t.fromPageDetection&&t.detectedIPs&&Ei(t.detectedIPs),await Si(t.selectedIP))}t.detectedIPs&&t.detectedIPs.length>0&&Ei(t.detectedIPs)}catch(t){console.error("Failed to check stored IP:",t)}}(),r()});const $i=document.getElementById("dark-mode-toggle");$i?.addEventListener("click",()=>{const t=document.body.classList.toggle("dark-mode");localStorage.setItem("darkMode",t.toString())}),window.analyzeIP=Si,window.clearGraph=Ai})();
//# sourceMappingURL=popup.js.map